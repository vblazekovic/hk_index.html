<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HK Podravka Administracija</title>
    <!-- Učitavanje Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Učitavanje fonta Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- UČITAVANJE VANJSKIH BIBLIOTEKA KAO STANDARDNE SKRIPTE -->
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
    <!-- Dodana biblioteka za generiranje QR koda -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

    <style>
        /* Definiranje klupskih boja */
        :root {
            --color-club-red: #cc0000; /* Crvena */
            --color-club-gold: #ffc107; /* Zlatna */
            --color-club-white: #ffffff; /* Bijela */
        }
        .bg-club-red { background-color: var(--color-club-red); }
        .text-club-red { color: var(--color-club-red); }
        .bg-club-gold { background-color: var(--color-club-gold); }
        .text-club-gold { color: var(--color-club-gold); }
        .border-club-red { border-color: var(--color-club-red); }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        /* Osiguravanje vidljivosti svih sekcija */
        .content-section {
            min-height: calc(100vh - 80px); /* Iznad fiksne navigacije */
        }
        .sidebar-item:hover {
            background-color: #a00000;
        }
        /* Custom scrollbar za bolji estetski dojam */
        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: var(--color-club-red);
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background-color: #f1f1f1;
        }
        /* Fiksna visina za QR kod (cca 150x150) */
        #qrCodeCanvas {
            max-width: 150px !important;
            max-height: 150px !important;
            width: 150px !important;
            height: 150px !important;
        }
        /* Rotacija emoji kape za rođendan */
        .bday-icon {
            display: inline-block;
            transform: rotate(-15deg) translateY(-2px);
            margin-right: 4px;
            font-size: 1.2em;
        }
    </style>
</head>
<body>

    <!-- Glavni spremnik -->
    <div id="appContainer" class="flex flex-col min-h-screen">
        <!-- Zaglavlje/Navigacija -->
        <header class="bg-club-red text-club-white shadow-lg fixed top-0 left-0 w-full z-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <!-- Dinamički Logo -->
                    <img id="headerLogo" src="https://placehold.co/40x40/cc0000/ffffff?text=HK" alt="Logo Kluba" class="h-10 w-10 rounded-full object-cover">
                    <h1 class="text-2xl font-black tracking-wider text-club-gold">HK PODRAVKA ADMIN</h1>
                </div>
                <div id="parentLogoutContainer" style="display:none;">
                    <button onclick="window.app.setSection('roditeljski_portal_login')" class="bg-club-gold hover:bg-yellow-600 text-club-red font-bold py-1 px-3 rounded-lg shadow-md text-sm">
                        Odjava (Roditelj)
                    </button>
                </div>
            </div>
        </header>

        <!-- Glavni sadržaj i bočni izbornik -->
        <div class="flex flex-1 pt-16">
            <!-- Bočni izbornik/Navigacija (Crvena sa BIJELIM slovima) -->
            <nav id="adminSidebar" class="bg-club-red w-64 p-4 shadow-xl fixed h-full overflow-y-auto hidden md:block custom-scroll">
                <div id="sidebarMenu" class="space-y-2 pt-2">
                    <button onclick="window.app.setSection('osnovne_info')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        1. Osnovne Informacije
                    </button>
                    <button onclick="window.app.setSection('treneri')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        2. Treneri
                    </button>
                    <button onclick="window.app.setSection('grupe')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        3. Grupe
                    </button>
                    <button onclick="window.app.setSection('clanovi')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        4. Članovi
                    </button>
                    <button onclick="window.app.setSection('natjecanja')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        5. Natjecanja i Rezultati
                    </button>
                    <button onclick="window.app.setSection('statistika')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        6. Statistika
                    </button>
                    <button onclick="window.app.setSection('veterani')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        7. Veterani
                    </button>
                    <button onclick="window.app.setSection('prisustvo')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        8. Prisustvo
                    </button>
                    <button onclick="window.app.setSection('obavijesti')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        9. Obavijesti
                    </button>
                    <button onclick="window.app.setSection('clanarine')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        10. Članarina
                    </button>
                    <button onclick="window.app.setSection('putni_nalozi')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-semibold transition duration-200 text-club-white">
                        11. Putni Nalozi
                    </button>
                    <div class="pt-4 border-t border-club-gold mt-4">
                        <button onclick="window.app.setSection('roditeljski_portal_login')" class="sidebar-item w-full text-left py-2 px-3 rounded-lg font-extrabold transition duration-200 text-club-gold bg-red-800">
                            RODITELJSKI PORTAL
                        </button>
                    </div>
                </div>
            </nav>

            <!-- Sadržaj glavne sekcije -->
            <main class="flex-1 p-4 md:ml-64 bg-white">
                <div id="messageBox" class="fixed top-20 right-4 z-50"></div>
                
                <!-- Sekcija 1: Osnovne Informacije -->
                <section id="osnovne_info" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">1. Osnovne Informacije Kluba</h2>
                    
                    <!-- Forma za Osnovne Informacije -->
                    <form id="clubInfoForm" onsubmit="event.preventDefault(); window.app.saveClubInfo(event)" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 p-6 bg-white rounded-lg shadow">
                        <!-- R1: Promjena u File Upload -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700">Logo Kluba (Upload slike):</label>
                            <input type="file" id="logoFile" name="logoFile" accept=".jpg,.png" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                            <p class="text-xs text-gray-500 mt-1">Odaberite sliku logotipa za prikaz u zaglavlju.</p>
                        </div>
                        <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Ime Kluba:</label>
                                <input type="text" id="clubName" name="clubName" value="Hrvački klub Podravka" readonly class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border bg-gray-100">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Sjedište (Ulica i broj):</label>
                                <input type="text" id="clubAddress" name="clubAddress" value="Radnička 10, druga ćelija" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Poštanski broj i Mjesto:</label>
                                <input type="text" id="clubCity" name="clubCity" value="48000 KOPRIVNICA" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700">OIB:</label>
                            <input type="text" id="clubOib" name="clubOib" value="60911784858" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">IBAN RAČUNA (ZA UPLATNICE):</label>
                            <input type="text" id="clubIBAN" name="clubIBAN" placeholder="HRxxxxxxxxxxxxxxxxxxxx" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Web Stranica:</label>
                            <input type="url" id="clubWeb" name="clubWeb" value="https://www.hk-podravka.com" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                        </div>

                        <!-- Društvene Mreže -->
                        <div class="md:col-span-2 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div><label class="block text-sm font-medium text-gray-700">Instagram Link:</label><input type="url" id="clubInstagram" name="clubInstagram" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                            <div><label class="block text-sm font-medium text-gray-700">Facebook Link:</label><input type="url" id="clubFacebook" name="clubFacebook" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                            <div><label class="block text-sm font-medium text-gray-700">TikTok Link:</label><input type="url" id="clubTikTok" name="clubTikTok" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                        </div>

                        <div class="md:col-span-2">
                            <button type="submit" class="w-full bg-club-red hover:bg-red-700 text-club-gold font-bold py-3 px-4 rounded-lg shadow-md transition duration-200">
                                SPREMI OSNOVNE INFORMACIJE
                            </button>
                            <button type="button" onclick="window.app.exportClubInfoToPDF()" class="w-full mt-2 bg-club-gold hover:bg-yellow-600 text-club-red font-bold py-3 px-4 rounded-lg shadow-md transition duration-200">
                                IZVOZ U PDF
                            </button>
                        </div>
                    </form>

                    <!-- R2: Unos Uprave i Nadzornog odbora -->
                    <div id="upravaContainer" class="p-6 bg-white rounded-lg shadow mt-8">
                        <h3 class="text-xl font-semibold mb-4 text-club-red border-b pb-2">Osobe u Upravi i Nadzornom Odboru</h3>
                        <form id="clubOfficialsForm" onsubmit="event.preventDefault(); window.app.saveClubOfficials()">
                            <p class="text-sm text-gray-600 mb-4">Unesite podatke za ključne funkcije. Polja su grupirana za lakši unos.</p>

                            <!-- Predsjednik -->
                            <div class="border p-4 rounded-lg mb-4 bg-red-50">
                                <h4 class="font-bold mb-2">PREDSJEDNIK KLUBA</h4>
                                <div class="grid grid-cols-5 gap-3 text-sm">
                                    <input type="text" name="ime" placeholder="Ime" id="PresidentName" value="Darko" required class="p-2 border rounded">
                                    <input type="text" name="prezime" placeholder="Prezime" id="PresidentSurname" value="Tetec" required class="p-2 border rounded">
                                    <input type="email" name="email" placeholder="Email" id="PresidentEmail" class="p-2 border rounded">
                                    <input type="text" name="oib" placeholder="OIB" id="PresidentOIB" class="p-2 border rounded">
                                    <input type="tel" name="kontakt" placeholder="Kontakt broj" id="PresidentContact" class="p-2 border rounded">
                                </div>
                            </div>
                            
                            <!-- Tajnik -->
                            <div class="border p-4 rounded-lg mb-4 bg-red-50">
                                <h4 class="font-bold mb-2">TAJNIK KLUBA</h4>
                                <div class="grid grid-cols-5 gap-3 text-sm">
                                    <input type="text" name="ime" placeholder="Ime" id="SecretaryName" value="Vedran" required class="p-2 border rounded">
                                    <input type="text" name="prezime" placeholder="Prezime" id="SecretarySurname" value="Blažeković" required class="p-2 border rounded">
                                    <input type="email" name="email" placeholder="Email" id="SecretaryEmail" class="p-2 border rounded">
                                    <input type="text" name="oib" placeholder="OIB" id="SecretaryOIB" class="p-2 border rounded">
                                    <input type="tel" name="kontakt" placeholder="Kontakt broj" id="SecretaryContact" class="p-2 border rounded">
                                </div>
                            </div>

                            <!-- Predsjedništvo (Članovi) -->
                            <div class="border p-4 rounded-lg mb-4 bg-red-50">
                                <h4 class="font-bold mb-2">PREDSJEDNIŠTVO (Članovi)</h4>
                                <div class="space-y-3 text-sm">
                                    <div class="grid grid-cols-5 gap-3">
                                        <input type="text" name="ime" placeholder="Ime" value="Miroslav" required class="p-2 border rounded">
                                        <input type="text" name="prezime" placeholder="Prezime" value="Mihalec" required class="p-2 border rounded">
                                        <input type="email" name="email" placeholder="Email" class="p-2 border rounded">
                                        <input type="text" name="oib" placeholder="OIB" class="p-2 border rounded">
                                        <input type="tel" name="kontakt" placeholder="Kontakt broj" class="p-2 border rounded">
                                    </div>
                                    <div class="grid grid-cols-5 gap-3">
                                        <input type="text" name="ime" placeholder="Ime" value="Dejan" required class="p-2 border rounded">
                                        <input type="text" name="prezime" placeholder="Prezime" value="Kuharić" required class="p-2 border rounded">
                                        <input type="email" name="email" placeholder="Email" class="p-2 border rounded">
                                        <input type="text" name="oib" placeholder="OIB" class="p-2 border rounded">
                                        <input type="tel" name="kontakt" placeholder="Kontakt broj" class="p-2 border rounded">
                                    </div>
                                    <div class="grid grid-cols-5 gap-3">
                                        <input type="text" name="ime" placeholder="Ime" value="Alen" required class="p-2 border rounded">
                                        <input type="text" name="prezime" placeholder="Prezime" value="Vavro" required class="p-2 border rounded">
                                        <input type="email" name="email" placeholder="Email" class="p-2 border rounded">
                                        <input type="text" name="oib" placeholder="OIB" class="p-2 border rounded">
                                        <input type="tel" name="kontakt" placeholder="Kontakt broj" class="p-2 border rounded">
                                    </div>
                                </div>
                            </div>

                            <!-- Nadzorni odbor -->
                            <div class="border p-4 rounded-lg mb-6 bg-red-50">
                                <h4 class="font-bold mb-2">NADZORNI ODBOR</h4>
                                <div class="space-y-3 text-sm">
                                    <div class="grid grid-cols-5 gap-3">
                                        <input type="text" name="ime" placeholder="Ime" value="Antonia" required class="p-2 border rounded">
                                        <input type="text" name="prezime" placeholder="Prezime" value="Lončarić" required class="p-2 border rounded">
                                        <input type="email" name="email" placeholder="Email" class="p-2 border rounded">
                                        <input type="text" name="oib" placeholder="OIB" class="p-2 border rounded">
                                        <input type="tel" name="kontakt" placeholder="Kontakt broj" class="p-2 border rounded">
                                    </div>
                                    <div class="grid grid-cols-5 gap-3">
                                        <input type="text" name="ime" placeholder="Ime" value="Ivan" required class="p-2 border rounded">
                                        <input type="text" name="prezime" placeholder="Prezime" value="Lončarić" required class="p-2 border rounded">
                                        <input type="email" name="email" placeholder="Email" class="p-2 border rounded">
                                        <input type="text" name="oib" placeholder="OIB" class="p-2 border rounded">
                                        <input type="tel" name="kontakt" placeholder="Kontakt broj" class="p-2 border rounded">
                                    </div>
                                    <div class="grid grid-cols-5 gap-3">
                                        <input type="text" name="ime" placeholder="Ime" value="Filip" required class="p-2 border rounded">
                                        <input type="text" name="prezime" placeholder="Prezime" value="Verčević" required class="p-2 border rounded">
                                        <input type="email" name="email" placeholder="Email" class="p-2 border rounded">
                                        <input type="text" name="oib" placeholder="OIB" class="p-2 border rounded">
                                        <input type="tel" name="kontakt" placeholder="Kontakt broj" class="p-2 border rounded">
                                    </div>
                                </div>
                            </div>

                            <button type="submit" class="w-full bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                SPREMI OSOBE UPRAVE/NADZORA
                            </button>
                        </form>
                        
                        <h3 class="text-xl font-semibold mb-4 mt-8 border-b pb-2">Dokumenti Kluba</h3>
                        <div id="clubDocuments" class="space-y-4">
                            <div class="flex items-center space-x-4">
                                <label class="block text-sm font-medium text-gray-700 w-1/3">Statut Kluba (PDF/DOCX):</label>
                                <input type="file" id="statutFile" accept=".pdf,.doc,.docx" class="mt-1 block w-2/3">
                            </div>
                            <div class="flex items-center space-x-4">
                                <label class="block text-sm font-medium text-gray-700 w-1/3">Ostali Dokumenti (npr. Zapisnici):</label>
                                <input type="file" id="otherDocsFile" accept=".pdf,.doc,.docx" multiple class="mt-1 block w-2/3">
                            </div>
                            <p class="text-sm text-gray-500">Napomena: Uploadi dokumenata u ovoj demo verziji ne spremaju datoteke, već samo linkaju na placeholder.</p>
                        </div>
                    </div>
                </section>

                <!-- Sekcija 2: Treneri -->
                <section id="treneri" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">2. Evidencija Trenera</h2>
                    
                    <button onclick="window.app.editCoach(null)" class="mb-6 bg-club-gold hover:bg-yellow-600 text-club-red font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                        + Dodaj Novog Trenera
                    </button>

                    <!-- Forma za unos/izmjenu trenera (skrivena/pojavljuje se) -->
                    <div id="coachFormContainer" class="p-6 bg-white rounded-lg shadow mb-8" style="display:none;">
                        <h3 id="coachFormTitle" class="text-xl font-semibold mb-4 border-b pb-2">Unos Novog Trenera</h3>
                        <form id="coachForm" onsubmit="event.preventDefault(); window.app.saveCoach(document.getElementById('coachSaveBtn').dataset.editId)">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <!-- R3: Promjena u File Upload -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Slika (Upload slike):</label>
                                    <input type="file" id="coachImageFile" name="imageFile" accept=".jpg,.png" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    <input type="hidden" id="coachImage" name="image" value=""> <!-- Za zadržavanje stare URL reference -->
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Ime:</label>
                                    <input type="text" id="coachFirstName" name="firstName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Prezime:</label>
                                    <input type="text" id="coachLastName" name="lastName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Datum Rođenja:</label>
                                    <input type="date" id="coachDOB" name="dob" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">OIB:</label>
                                    <input type="text" id="coachOIB" name="oib" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Mjesto Prebivališta:</label>
                                    <input type="text" id="coachCity" name="city" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Ulica i K.Broj:</label>
                                    <input type="text" id="coachAddress" name="address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">E-mail Adresa:</label>
                                    <input type="email" id="coachEmail" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Broj Mobitela:</label>
                                    <input type="tel" id="coachPhone" name="phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                <div class="md:col-span-3">
                                    <label class="block text-sm font-medium text-gray-700">IBAN RAČUNA:</label>
                                    <input type="text" id="coachIBAN" name="iban" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                            </div>
                            <div class="mt-6 flex space-x-4">
                                <button type="submit" id="coachSaveBtn" data-edit-id="" class="bg-club-red hover:bg-red-700 text-club-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    SPREMI
                                </button>
                                <button type="button" onclick="document.getElementById('coachFormContainer').style.display='none';" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    ODUSTANI
                                </button>
                            </div>
                        </form>
                    </div>

                    <div id="coachesListContainer" class="p-6 bg-white rounded-lg shadow mt-8">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Lista Trenera</h3>
                        <div id="coachesList" class="space-y-3">
                            <!-- Dinamički popis trenera -->
                        </div>
                    </div>
                </section>

                <!-- Sekcija 3: Grupe -->
                <section id="grupe" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">3. Upravljanje Grupama</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Forma za unos grupe -->
                        <div class="p-6 bg-white rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4 border-b pb-2">Unos Nove Grupe</h3>
                            <form id="groupForm" onsubmit="event.preventDefault(); window.app.saveGroup()">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700">Naziv Grupe:</label>
                                    <input type="text" id="groupName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700">Odgovorni Treneri (Moguće više njih):</label>
                                    <!-- Višestruki odabir trenera -->
                                    <select id="groupCoaches" multiple class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border coach-select-dropdown h-32"></select>
                                </div>
                                <button type="submit" class="bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    SPREMI GRUPU
                                </button>
                            </form>
                        </div>
                        
                        <!-- Lista grupa -->
                        <div class="p-6 bg-white rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4 border-b pb-2">Lista Aktivnih Grupa</h3>
                            <div id="groupsList" class="space-y-3">
                                <!-- Dinamički popis grupa -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Sekcija 4: Članovi -->
                <section id="clanovi" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">4. Evidencija Članova</h2>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <button onclick="window.app.openMemberEditForm(null)" class="bg-club-gold hover:bg-yellow-600 text-club-red font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                            + Dodaj Novog Člana
                        </button>
                        <button onclick="window.app.downloadMemberTemplate()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                            Preuzmi Predložak (.xlsx)
                        </button>
                        <button onclick="window.app.uploadMembersXLSX()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                            Upload Članova (.xlsx)
                        </button>
                    </div>

                    <!-- Forma za unos/izmjenu člana -->
                    <div id="memberFormContainer" class="p-6 bg-white rounded-lg shadow mb-8" style="display:none;">
                        <h3 id="memberFormTitle" class="text-xl font-semibold mb-4 border-b pb-2">Unos Novog Člana</h3>
                        <form id="memberForm" onsubmit="event.preventDefault(); window.app.saveMember(document.getElementById('memberSaveBtn').dataset.editId)">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                
                                <!-- Osnovni Podaci -->
                                <div><label class="block text-sm font-medium text-gray-700">Ime:</label><input type="text" id="memberFirstName" name="firstName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Prezime:</label><input type="text" id="memberLastName" name="lastName" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Datum Rođenja:</label><input type="date" id="memberDOB" name="dob" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Spol:</label>
                                    <select id="memberGender" name="gender" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                        <option value="M">Muško (M)</option>
                                        <option value="F">Žensko (Ž)</option>
                                    </select>
                                </div>
                                <div><label class="block text-sm font-medium text-gray-700">OIB (Obavezno):</label><input type="text" id="memberOIB" name="oib" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Mjesto Prebivališta:</label><input type="text" id="memberCity" name="city" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Ulica i K.Broj:</label><input type="text" id="memberAddress" name="address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">E-mail Člana:</label><input type="email" id="memberEmail" name="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">E-mail Roditelja:</label><input type="email" id="memberParentEmail" name="parentEmail" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>

                                <!-- Dokumenti -->
                                <div class="md:col-span-4 grid grid-cols-1 md:grid-cols-4 gap-4 border p-3 rounded-lg bg-gray-50">
                                    <p class="md:col-span-4 font-semibold text-club-red">Identifikacijski dokumenti</p>
                                    <div><label class="block text-sm font-medium text-gray-700">Broj Osobne:</label><input type="text" id="memberIDCard" name="idCard" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Vrijedi do:</label><input type="date" id="memberIDValidUntil" name="idValidUntil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Izdana od:</label><input type="text" id="memberIDIssuedBy" name="idIssuedBy" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                    
                                    <div><label class="block text-sm font-medium text-gray-700">Broj Putovnice:</label><input type="text" id="memberPassport" name="passport" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Vrijedi do:</label><input type="date" id="memberPassportValidUntil" name="passportValidUntil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Izdana od:</label><input type="text" id="memberPassportIssuedBy" name="passportIssuedBy" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                </div>

                                <!-- Kategorizacija i Grupa -->
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700">Grupa Člana:</label>
                                    <select id="memberGroup" name="group" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border group-select-dropdown"></select>
                                </div>

                                <div class="md:col-span-2 grid grid-cols-3 gap-2 p-3 bg-club-gold rounded-lg shadow-inner">
                                    <div class="flex items-center"><input type="checkbox" id="memberActive" name="active" class="h-4 w-4 text-club-red border-gray-300 rounded"><label for="memberActive" class="ml-2 text-sm font-medium">Aktivni Natjecatelj/ica</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="memberVeteran" name="veteran" class="h-4 w-4 text-club-red border-gray-300 rounded"><label for="memberVeteran" class="ml-2 text-sm font-medium">Veteran</label></div>
                                    <div class="flex items-center"><input type="checkbox" id="memberOther" name="other" class="h-4 w-4 text-club-red border-gray-300 rounded"><label for="memberOther" class="ml-2 text-sm font-medium">Ostalo</label></div>
                                </div>
                                
                                <!-- Liječnički pregled + NOVI DOKUMENTI -->
                                <div class="md:col-span-4 grid grid-cols-1 md:grid-cols-4 gap-4 border p-3 rounded-lg bg-gray-50">
                                    <p class="md:col-span-4 font-semibold text-club-red">Liječnički i Dokumentacija (Uploadovi)</p>
                                    
                                    <!-- Liječnički -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Upload Liječničke:</label>
                                        <input type="file" id="memberMedicalFile" name="medicalFile" accept=".pdf,.jpg,.png" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Liječnički Vrijedi do:</label>
                                        <input type="date" id="memberMedicalValidUntil" name="medicalValidUntil" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    </div>

                                    <!-- Kategorizacija -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Upload Kategorizacije:</label>
                                        <input type="file" id="memberCategorizationFile" name="categorizationFile" accept=".pdf,.jpg,.png" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Kategorizacija Vrijedi do:</label>
                                        <input type="date" id="memberCategorizationValidUntil" name="categorizationValidUntil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    </div>

                                    <!-- Ugovor s Klubom -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Upload Ugovora:</label>
                                        <input type="file" id="memberContractFile" name="contractFile" accept=".pdf,.jpg,.png" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Ugovor Vrijedi do:</label>
                                        <input type="date" id="memberContractValidUntil" name="contractValidUntil" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    </div>

                                    <!-- Privola/Pristupnica -->
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Upload Privole:</label>
                                        <input type="file" id="memberConsentFile" name="consentFile" accept=".pdf,.jpg,.png" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700">Upload Pristupnice:</label>
                                        <input type="file" id="memberAccessionFile" name="accessionFile" accept=".pdf,.jpg,.png" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    </div>
                                    
                                    <div id="medicalStatus" class="md:col-span-4 text-sm font-semibold p-2 rounded-lg text-center" style="display:none;"></div>
                                </div>

                            </div>
                            <div class="mt-6 flex space-x-4">
                                <button type="submit" id="memberSaveBtn" data-edit-id="" class="bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    SPREMI ČLANA
                                </button>
                                <button type="button" onclick="document.getElementById('memberFormContainer').style.display='none';" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    ODUSTANI
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Lista Članova -->
                    <div id="membersListContainer" class="p-6 bg-white rounded-lg shadow mt-8">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Lista Svih Članova</h3>
                        <div id="membersList" class="space-y-3 overflow-x-auto">
                            <!-- Dinamički popis članova -->
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ime i Prezime</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grupa</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Liječnički Istek</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Statusi Dok.</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Akcije</th>
                                    </tr>
                                </thead>
                                <tbody id="membersTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Dinamički redovi članova -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Sekcija 5: Natjecanja i Rezultati -->
                <section id="natjecanja" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">5. Unos Natjecanja i Rezultata</h2>
                    
                    <button onclick="window.app.editCompetition(null)" class="mb-6 bg-club-gold hover:bg-yellow-600 text-club-red font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                        + Unos Novog Natjecanja
                    </button>

                    <!-- Forma za unos natjecanja -->
                    <div id="competitionFormContainer" class="p-6 bg-white rounded-lg shadow mb-8" style="display:none;">
                        <h3 id="competitionFormTitle" class="text-xl font-semibold mb-4 border-b pb-2">Detalji Natjecanja</h3>
                        <form id="competitionForm" onsubmit="event.preventDefault(); window.app.saveCompetition(document.getElementById('competitionSaveBtn').dataset.editId)">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <!-- Vrsta Natjecanja -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Vrsta Natjecanja:</label>
                                    <select id="compType" name="type" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                        <option value="PH">PRVENSTVO HRVATSKE</option>
                                        <option value="MT">MEĐUNARODNI TURNIR</option>
                                        <option value="RN">REPREZENTATIVNI NASTUP</option>
                                        <option value="HL">HRVAČKA LIGA ZA SENIORE</option>
                                        <option value="MHL">MEĐUNARODNA HRVAČKA LIGA ZA KADETE</option>
                                        <option value="RP">REGIONALNO PRVENSTVO</option>
                                        <option value="LG">LIGA ZA DJEVOJČICE</option>
                                        <option value="OSTALO">OSTALO (Ručni Unos)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Ručni Unos Vrste:</label>
                                    <input type="text" id="compOtherType" name="otherType" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border" disabled>
                                </div>
                                <!-- Datum i Mjesto -->
                                <div><label class="block text-sm font-medium text-gray-700">Datum OD:</label><input type="date" id="compDateFrom" name="dateFrom" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Datum DO (opcionalno):</label><input type="date" id="compDateTo" name="dateTo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Mjesto Natjecanja:</label><input type="text" id="compLocation" name="location" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>

                                <!-- Stil i Uzrast -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Hrvački Stil:</label>
                                    <select id="compStyle" name="style" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                        <option value="GR">GR</option><option value="FS">FS</option><option value="WW">WW</option><option value="BW">BW</option><option value="MOD">MODIFICIRING</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Uzrast:</label>
                                    <select id="compAgeGroup" name="ageGroup" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                        <option value="P">POČETNICI</option><option value="U11">U11</option><option value="U13">U13</option><option value="U15">U15</option><option value="U17">U17</option>
                                        <option value="U20">U20</option><option value="U23">U23</option><option value="SEN">SENIORI</option>
                                    </select>
                                </div>
                                
                                <!-- Država -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Država:</label>
                                    <select id="compCountry" name="country" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                        <!-- Ovdje bi se dinamički popunio popis svih država -->
                                        <option value="HR">Hrvatska</option><option value="SRB">Srbija</option><option value="HUN">Mađarska</option><option value="SLO">Slovenija</option><option value="BIH">Bosna i Hercegovina</option>
                                        <option value="AUT">Austrija</option><option value="GER">Njemačka</option><option value="ITA">Italija</option>
                                    </select>
                                </div>
                                <div><label class="block text-sm font-medium text-gray-700">Kratica Države (3 slova):</label><input type="text" id="compCountryCode" name="countryCode" readonly class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border bg-gray-100"></div>
                                
                                <!-- Sudjelovanje -->
                                <div><label class="block text-sm font-medium text-gray-700">Ekipni Poredak (HKP):</label><input type="number" id="compTeamRank" name="teamRank" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border" min="1"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Broj Natjecatelja (HKP):</label><input type="number" id="compHkpCompetitors" name="hkpCompetitors" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border" min="0"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Ukupno Natjecatelja:</label><input type="number" id="compTotalCompetitors" name="totalCompetitors" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border" min="0"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Broj Klubova:</label><input type="number" id="compTotalClubs" name="totalClubs" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border" min="0"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Broj Zemalja:</label><input type="number" id="compTotalCountries" name="totalCountries" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border" min="0"></div>
                                
                                <!-- Treneri -->
                                <div class="md:col-span-4">
                                    <label class="block text-sm font-medium text-gray-700">Treneri koji su vodili:</label>
                                    <select id="compCoaches" multiple class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border coach-select-dropdown h-32"></select>
                                </div>
                                
                                <!-- DETALJI PUTOVANJA -->
                                <div class="md:col-span-4 p-4 border rounded-lg bg-club-gold shadow-inner">
                                    <h4 class="text-lg font-bold mb-3 text-club-red">Logistika Putovanja</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Vrsta Prijevoza:</label>
                                            <select id="travelType" name="travelType" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                                <option value="SLUZBENO">Službeno Vozilo</option>
                                                <option value="OSOBNO">Osobno Vozilo</option>
                                                <option value="OSTALO">Ostalo (Autobus, Vlak)</option>
                                            </select>
                                        </div>
                                        <div id="mileageFields" class="md:col-span-3 grid grid-cols-4 gap-4" style="display:none;">
                                            <div class="col-span-2">
                                                <label class="block text-sm font-medium text-gray-700">Početna KM:</label>
                                                <input type="number" id="startMileage" name="startMileage" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border" min="0">
                                            </div>
                                            <div class="col-span-2">
                                                <label class="block text-sm font-medium text-gray-700">Završna KM:</label>
                                                <input type="number" id="endMileage" name="endMileage" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border" min="0">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700">Vrijeme Polaska:</label>
                                                <input type="time" id="timeDeparture" name="timeDeparture" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700">Vrijeme Dolaska:</label>
                                                <input type="time" id="timeArrival" name="timeArrival" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Zapažanja -->
                                <div class="md:col-span-4">
                                    <label class="block text-sm font-medium text-gray-700">Kratko zapažanje trenera (za objavu):</label>
                                    <textarea id="compObservation" name="observation" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></textarea>
                                </div>
                                
                                <!-- Upload Slike - PROMIJENJENO NA FILE INPUT -->
                                <div class="md:col-span-4">
                                    <label class="block text-sm font-medium text-gray-700">Upload slika s natjecanja (.jpg/.png):</label>
                                    <input type="file" id="compImageUrls" name="imageUrls" accept=".jpg,.png" multiple class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    <p class="text-xs text-gray-500 mt-1">Napomena: Ova demo verzija ne obrađuje stvarne datoteke, ali prihvaća odabir.</p>
                                </div>
                            </div>
                            
                            <!-- Unos Rezultata Hrvača (Dinamički dodano) -->
                            <div id="competitorResultsContainer" class="mt-8 p-4 border rounded-lg bg-gray-50">
                                <h4 class="text-lg font-semibold mb-4 text-club-red">Rezultati Natjecatelja</h4>
                                <div id="competitorResults">
                                    <p class="text-sm text-gray-500">Nakon unosa broja natjecatelja (HKP) iznad i spremanja natjecanja, ovdje se dinamički dodaju polja za unos pojedinačnih rezultata.</p>
                                </div>
                                <button type="button" onclick="window.app.addCompetitorResultField()" class="mt-4 bg-gray-400 hover:bg-gray-500 text-white font-bold py-1 px-3 rounded-lg text-sm">
                                    + Dodaj Rezultat Člana Ručno
                                </button>
                                <button type="button" class="mt-4 bg-gray-400 hover:bg-gray-500 text-white font-bold py-1 px-3 rounded-lg text-sm" disabled>
                                    Upload Rezultata (.xlsx)
                                </button>
                            </div>

                            <div class="mt-6 flex space-x-4">
                                <button type="submit" id="competitionSaveBtn" data-edit-id="" class="bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    SPREMI NATJECANJE (Generiraj Putni Nalog/e)
                                </button>
                                <button type="button" onclick="document.getElementById('competitionFormContainer').style.display='none';" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    ODUSTANI
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Lista Natjecanja -->
                    <div id="competitionsListContainer" class="p-6 bg-white rounded-lg shadow mt-8">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Lista Održanih Natjecanja</h3>
                        <div id="competitionsList" class="space-y-3 overflow-x-auto">
                            <!-- Dinamički popis natjecanja -->
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Datum</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vrsta/Mjesto</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Uzrast/Stil</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Treneri</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Akcije</th>
                                    </tr>
                                </thead>
                                <tbody id="competitionsTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Dinamički redovi natjecanja -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Sekcija 6: Statistika -->
                <section id="statistika" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">6. Statistika Kluba i Članova</h2>
                    
                    <div class="p-6 bg-white rounded-lg shadow mb-8">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Filtri za Statistiku</h3>
                        <form id="statisticsFilterForm" onsubmit="event.preventDefault(); window.app.renderStatistics()">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Filtar po Godini/Mjesecu:</label>
                                    <input type="month" id="statsMonthYear" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Filtar po Sportašu/ici:</label>
                                    <select id="statsMember" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border member-select-dropdown">
                                        <option value="">-- Svi članovi --</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Filtar po Kategoriji (Uzrastu):</label>
                                    <select id="statsCategory" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                        <option value="">-- Sve kategorije --</option>
                                        <option value="P">POČETNICI</option><option value="U11">U11</option><option value="U13">U13</option><option value="U15">U15</option><option value="U17">U17</option>
                                        <option value="U20">U20</option><option value="U23">U23</option><option value="SEN">SENIORI</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Filtar po Natjecanju:</label>
                                    <select id="statsCompetition" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border competition-select-dropdown">
                                        <option value="">-- Sva natjecanja --</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mt-6">
                                <button type="submit" class="bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    PRIKAŽI STATISTIKU
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- Rezultati Statistike -->
                    <div id="statisticsResultsContainer" class="p-6 bg-white rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Rezultati Analize</h3>
                        <div id="statisticsResults" class="space-y-4">
                            <!-- Dinamički sadržaj statistike -->
                            <p class="text-gray-500">Koristite filtre iznad za generiranje izvještaja.</p>
                        </div>
                    </div>
                </section>

                <!-- Sekcija 7: Veterani -->
                <section id="veterani" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">7. Popis Veterana</h2>
                    
                    <div id="veteransListContainer" class="p-6 bg-white rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Aktivni Veterani</h3>
                        <div id="veteransList" class="space-y-3 overflow-x-auto">
                            <!-- Dinamički popis veterana -->
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ime i Prezime</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grupa</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">OIB</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Akcije</th>
                                    </tr>
                                </thead>
                                <tbody id="veteransTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Dinamički redovi veterana -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Sekcija 8: Prisustvo -->
                <section id="prisustvo" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">8. Evidencija Prisustva i Priprema</h2>

                    <!-- Evidencija Treninga i Prisustva Članova -->
                    <div id="attendanceEntryContainer" class="p-6 bg-white rounded-lg shadow mb-8">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Unos Treninga i Prisustva</h3>
                        <form id="attendanceForm" onsubmit="event.preventDefault(); window.app.saveAttendance()">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                <!-- Podaci o treningu -->
                                <!-- Treneri moraju biti prvi na zahtjev korisnika -->
                                <div class="md:col-span-4">
                                    <label class="block text-sm font-medium text-gray-700">Treneri (Moguće više njih):</label>
                                    <select id="attCoaches" multiple required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border coach-select-dropdown h-32"></select>
                                </div>

                                <div><label class="block text-sm font-medium text-gray-700">Datum Treninga:</label><input type="date" id="attDate" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Vrijeme OD (sati):</label><input type="time" id="attTimeFrom" step="1800" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Vrijeme DO (sati):</label><input type="time" id="attTimeTo" step="1800" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Mjesto Treninga:</label>
                                    <select id="attLocation" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                        <option value="DS">DVORANA SJEVER</option><option value="IA">IGRALIŠTE ANG</option><option value="IS">IGRALIŠTE SREDNJA</option>
                                        <option value="OSTALO">OSTALO (Ručni unos)</option>
                                    </select>
                                </div>
                                
                                <div id="attOtherLocationContainer" style="display:none;"><label class="block text-sm font-medium text-gray-700">Ručno Mjesto:</label><input type="text" id="attOtherLocation" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                
                                <div class="md:col-span-4">
                                    <label class="block text-sm font-medium text-gray-700">Grupe koje su prisutne (Za filtriranje):</label>
                                    <select id="attGroup" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border group-select-dropdown"></select>
                                </div>
                            </div>
                            <button type="submit" id="saveTrainingBtn" class="bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                SPREMI TRENING I UNESI PRISUTNOST ČLANOVA
                            </button>
                        </form>
                        
                        <!-- Popis članova za unos prisutnosti -->
                        <div id="memberAttendanceListContainer" class="mt-6 p-4 border rounded-lg bg-gray-50" style="display:none;">
                            <h4 class="text-lg font-semibold mb-4 text-club-red">Unos Prisutnosti Članova</h4>
                            <p class="mb-4 text-sm text-gray-600">Označite kvačicom članove koji su prisutni na ovom treningu.</p>
                            <form id="saveMemberAttendanceForm" onsubmit="event.preventDefault(); window.app.saveMemberAttendance()">
                                <input type="hidden" id="trainingIdToSave" value="">
                                <div id="memberAttendanceCheckboxes" class="grid grid-cols-2 md:grid-cols-4 gap-4 max-h-64 overflow-y-auto custom-scroll p-3 border rounded-lg bg-white">
                                    <!-- Dinamički popis članova -->
                                </div>
                                <div class="mt-4 flex space-x-4">
                                    <button type="submit" class="bg-club-gold hover:bg-yellow-600 text-club-red font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                        SPREMI PRISUTNOST
                                    </button>
                                    <button type="button" onclick="document.getElementById('memberAttendanceListContainer').style.display='none'" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                        ZATVORI
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Evidencija Priprema -->
                    <div id="preparationEntryContainer" class="p-6 bg-white rounded-lg shadow mb-8">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Unos Priprema (Reprezentacija, Kampovi)</h3>
                        <form id="preparationForm" onsubmit="event.preventDefault(); window.app.savePreparation()">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Član Kluba:</label>
                                    <select id="prepMember" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border member-select-dropdown"></select>
                                </div>
                                <div><label class="block text-sm font-medium text-gray-700">Gdje su Pripreme:</label><input type="text" id="prepLocation" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">O kakvim se pripremama radi:</label><input type="text" id="prepType" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Tko vodi Pripreme:</label><input type="text" id="prepLeader" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Datum OD:</label><input type="date" id="prepDateFrom" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Datum DO:</label><input type="date" id="prepDateTo" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Broj Odrađenih Treninga:</label><input type="number" id="prepTrainings" min="1" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Broj Sati:</label><input type="number" id="prepHours" min="0.5" step="0.5" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                            </div>
                            <button type="submit" class="mt-6 bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                SPREMI PRIPREMU
                            </button>
                        </form>
                    </div>

                    <!-- Lista Treninga -->
                    <div id="trainingsListContainer" class="p-6 bg-white rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Lista Održanih Treninga</h3>
                        <div id="trainingsList" class="space-y-3 overflow-x-auto">
                            <!-- Dinamički popis treninga -->
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Datum</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Grupa/Mjesto</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Treneri</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Sati</th>
                                    </tr>
                                </thead>
                                <tbody id="trainingsTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Dinamički redovi treninga -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Sekcija 9: Obavijesti -->
                <section id="obavijesti" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">9. Slanje Obavijesti</h2>
                    
                    <div class="p-6 bg-white rounded-lg shadow mb-8">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Kreiranje i Slanje E-mail Obavijesti</h3>
                        <form id="notificationForm" onsubmit="event.preventDefault(); window.app.sendNotification()">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700">Odabir Primatelja:</label>
                                <select id="recipientType" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                    <option value="ALL">Svi Članovi i Roditelji</option>
                                    <option value="MEMBER_LIST">Odaberi Članove (Sportaši)</option>
                                    <option value="PARENT_LIST">Odaberi Roditelje</option>
                                    <option value="GROUP">Po Grupama</option>
                                    <option value="COACHES">Samo Treneri</option>
                                </select>
                            </div>
                            
                            <div id="specificRecipientsContainer" class="mb-4 p-3 bg-gray-50 rounded-lg" style="display:none;">
                                <!-- Dinamički odabir članova/grupa -->
                            </div>

                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700">Naslov E-maila:</label>
                                <input type="text" id="notificationSubject" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700">Poruka/Sadržaj:</label>
                                <textarea id="notificationBody" rows="6" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></textarea>
                                <p class="text-xs text-gray-500 mt-1">Logo kluba bit će automatski dodan na vrh poruke.</p>
                            </div>

                            <div class="flex space-x-4">
                                <button type="submit" class="bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    POŠALJI OBAVIJEST (Simulacija Slanja)
                                </button>
                                <button type="button" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200" disabled>
                                    IZVOZ PODATAKA U EXCEL
                                </button>
                            </div>
                        </form>
                    </div>
                </section>

                <!-- Sekcija 10: Članarina -->
                <section id="clanarine" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">10. Članarina i Uplatnice</h2>

                    <!-- Kreiranje Članarine -->
                    <div class="p-6 bg-white rounded-lg shadow mb-8">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Kreiranje Mjesečne Članarine</h3>
                        <form id="feeCreationForm" onsubmit="event.preventDefault(); window.app.createMembershipFees()">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                <div><label class="block text-sm font-medium text-gray-700">Iznos Članarine (EUR):</label><input type="number" id="feeAmount" required value="20" min="1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Za Mjesec/Godinu:</label><input type="month" id="feeMonthYear" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Tip Kreiranja:</label>
                                    <select id="feeRecipientType" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                        <option value="ALL">Za SVE Aktivne Članove</option>
                                        <option value="GROUP">Po Grupama</option>
                                        <option value="SINGLE">Pojedinačno</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div id="feeSpecificRecipientsContainer" class="mb-4 p-3 bg-gray-50 rounded-lg" style="display:none;">
                                <!-- Dinamički odabir članova/grupa -->
                            </div>

                            <button type="submit" class="bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                KREIRAJ UPLATNICE
                            </button>
                        </form>
                    </div>

                    <!-- Lista Članarina -->
                    <div id="feesListContainer" class="p-6 bg-white rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Evidencija Članarina</h3>
                        <div id="feesList" class="space-y-3 overflow-x-auto">
                            <!-- Dinamički popis članarina -->
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Član</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Mjesec/Godina</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Iznos</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Akcije</th>
                                    </tr>
                                </thead>
                                <tbody id="feesTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Dinamički redovi članarina -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Modal za generiranje Uplatnice -->
                    <div id="paymentSlipModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" style="display:none;">
                        <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-lg">
                            <h3 class="text-2xl font-bold mb-4 text-club-red">Generirana Uplatnica (Slikaj i Plati)</h3>
                            <div id="paymentSlipContent" class="border p-4 rounded-lg bg-gray-50">
                                <div id="barcodeSvg" class="flex justify-center mb-4"></div>
                                <div id="qrCodeContainer" class="flex flex-col items-center justify-center p-4 bg-white rounded-lg shadow-inner mb-4">
                                    <canvas id="qrCodeCanvas"></canvas>
                                    <p class="text-xs font-semibold mt-2 text-club-red">SKENIRAJ ZA PLAĆANJE (HUB3A)</p>
                                </div>
                                <div id="slipDetails" class="space-y-1 text-sm"></div>
                            </div>
                            <div class="mt-4 flex justify-end space-x-3">
                                <button onclick="window.app.exportPaymentSlipToPDF()" class="bg-club-gold hover:bg-yellow-600 text-club-red font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    PREUZMI PDF
                                </button>
                                <button onclick="window.app.hideModal('paymentSlipModal')" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    ZATVORI
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Sekcija 11: Putni Nalozi -->
                <section id="putni_nalozi" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">11. Putni Nalozi</h2>
                    
                    <button onclick="window.app.showTravelOrderForm()" class="mb-6 bg-club-gold hover:bg-yellow-600 text-club-red font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                        + Kreiraj Novi Putni Nalog (bez natjecanja)
                    </button>

                    <!-- Forma za ručni unos (Manual Travel Order Form) -->
                    <div id="manualTravelOrderFormContainer" class="p-6 bg-white rounded-xl shadow-lg mb-8" style="display:none;">
                        <h3 id="manualTravelOrderFormTitle" class="text-xl font-semibold mb-4 border-b pb-2">Ručni Unos Putnog Naloga</h3>
                        <form id="manualTravelOrderForm" onsubmit="event.preventDefault(); window.app.saveManualTravelOrder(document.getElementById('manualTravelOrderForm').dataset.editId)">
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <!-- Podaci o putu -->
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700">Osoba koja putuje (Trener/službena osoba):</label>
                                    <select id="manualCoach" name="manualCoach" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border coach-select-dropdown"></select>
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700">Svrha Putovanja:</label>
                                    <input type="text" id="manualPurpose" name="manualPurpose" placeholder="Npr. Službeni sastanak, nabava opreme..." required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                </div>
                                
                                <div><label class="block text-sm font-medium text-gray-700">Datum OD:</label><input type="date" id="manualDateFrom" name="manualDateFrom" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Datum DO (opcionalno):</label><input type="date" id="manualDateTo" name="manualDateTo" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                
                                <div><label class="block text-sm font-medium text-gray-700">Odredište (Mjesto):</label><input type="text" id="manualDestination" name="manualDestination" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></div>
                                <div><label class="block text-sm font-medium text-gray-700">Kratica Države (HR, SLO...):</label><input type="text" id="manualCountryCode" name="manualCountryCode" required maxlength="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border uppercase"></div>

                                <!-- R9: Logistika putovanja za ručni nalog -->
                                <div class="md:col-span-4 p-4 border rounded-lg bg-gray-100 shadow-inner">
                                    <h4 class="text-md font-bold mb-3 text-club-red">Logistika Prijevoza (Opcionalno)</h4>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700">Vrsta Prijevoza:</label>
                                            <select id="manualTravelType" name="manualTravelType" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                                <option value="OSTALO">Ostalo (Autobus, Vlak)</option>
                                                <option value="SLUZBENO">Službeno Vozilo</option>
                                                <option value="OSOBNO">Osobno Vozilo</option>
                                            </select>
                                        </div>
                                        <div id="manualMileageFields" class="md:col-span-3 grid grid-cols-4 gap-4" style="display:none;">
                                            <div class="col-span-2">
                                                <label class="block text-sm font-medium text-gray-700">Početna KM:</label>
                                                <input type="number" id="manualStartMileage" name="manualStartMileage" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border" min="0">
                                            </div>
                                            <div class="col-span-2">
                                                <label class="block text-sm font-medium text-gray-700">Završna KM:</label>
                                                <input type="number" id="manualEndMileage" name="manualEndMileage" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border" min="0">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700">Vrijeme Polaska:</label>
                                                <input type="time" id="manualTimeDeparture" name="manualTimeDeparture" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700">Vrijeme Dolaska:</label>
                                                <input type="time" id="manualTimeArrival" name="manualTimeArrival" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="md:col-span-4">
                                    <label class="block text-sm font-medium text-gray-700">Napomene/Detalji:</label>
                                    <textarea id="manualNotes" name="manualNotes" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border"></textarea>
                                </div>
                            </div>
                            <div class="mt-6 flex space-x-4">
                                <button type="submit" class="bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    SPREMI PUTNI NALOG
                                </button>
                                <button type="button" onclick="document.getElementById('manualTravelOrderFormContainer').style.display='none';" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    ODUSTANI
                                </button>
                            </div>
                        </form>
                    </div>

                    <div id="travelOrdersListContainer" class="p-6 bg-white rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Generirani Putni Nalozi</h3>
                        <div id="travelOrdersList" class="space-y-3 overflow-x-auto">
                            <!-- Dinamički popis putnih naloga -->
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Br. Naloga</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trener</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Natjecanje/Svrha</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Datum</th>
                                        <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Akcije</th>
                                    </tr>
                                </thead>
                                <tbody id="travelOrdersTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Dinamički redovi putnih naloga -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Modal za generiranje Putnog Naloga -->
                    <div id="travelOrderModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" style="display:none;">
                        <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                            <h3 class="text-2xl font-bold mb-4 text-club-red">Generirani Putni Nalog</h3>
                            <div id="travelOrderContent" class="border p-4 rounded-lg bg-gray-50 text-sm">
                                <!-- Sadržaj Putnog Naloga (simulacija) -->
                            </div>
                            <div class="mt-4 flex justify-end space-x-3">
                                <button onclick="window.app.exportTravelOrderToPDF()" class="bg-club-gold hover:bg-yellow-600 text-club-red font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    PREUZMI PDF
                                </button>
                                <button onclick="window.app.hideModal('travelOrderModal')" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                    ZATVORI
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- NOVI ODJELJAK: Roditeljski Portal (Prijava) -->
                <section id="roditeljski_portal_login" class="content-section flex items-center justify-center p-6" style="min-height: calc(100vh - 80px);">
                    <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-2xl text-center">
                        <h2 class="text-3xl font-extrabold text-club-red mb-4">Roditeljski Portal</h2>
                        <p class="text-gray-600 mb-6">Prijava za roditelje/staratelje.</p>
                        <form id="parentLoginForm" onsubmit="event.preventDefault(); window.app.parentLogin()">
                            <div class="mb-4 text-left">
                                <label class="block text-sm font-medium text-gray-700">Email Roditelja:</label>
                                <input type="email" id="parentLoginEmail" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                            </div>
                            <div class="mb-6 text-left">
                                <label class="block text-sm font-medium text-gray-700">OIB Djeteta (Člana Kluba):</label>
                                <input type="text" id="parentLoginOIB" required maxlength="11" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 border">
                            </div>
                            <button type="submit" class="w-full bg-club-red hover:bg-red-700 text-club-gold font-bold py-3 px-4 rounded-lg shadow-md transition duration-200">
                                PRIJAVA
                            </button>
                            <p class="text-xs text-gray-500 mt-4">Svi podaci moraju biti točno uneseni kao u klupskoj evidenciji.</p>
                        </form>
                    </div>
                </section>
                
                <!-- NOVI ODJELJAK: Roditeljski Portal (Prikaz) -->
                <section id="roditeljski_portal" class="content-section p-6 rounded-xl shadow-lg bg-gray-50" style="display:none;">
                    <h2 class="text-3xl font-bold mb-6 text-club-red border-b pb-2 border-club-gold">Portal za Roditelja: <span id="portalChildName" class="text-gray-700"></span></h2>

                    <!-- Status i Dokumentacija -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                        <!-- Status Člana/Dokumentacija -->
                        <div class="lg:col-span-1 p-6 bg-white rounded-xl shadow">
                            <h3 class="text-xl font-semibold mb-4 border-b pb-2">Status i Liječnički</h3>
                            <div id="portalMedicalStatus" class="p-3 rounded-lg text-center font-bold mb-4 bg-gray-100">Učitavanje...</div>
                            <h4 class="font-bold text-club-red mb-2">Upload Dokumenata:</h4>
                            <form id="parentUploadForm" onsubmit="event.preventDefault(); window.app.parentUploadDocuments()">
                                <div class="space-y-3">
                                    <div><label class="block text-sm font-medium text-gray-700">Slika Člana:</label><input type="file" id="portalPhoto" name="photo" accept=".jpg,.png" class="mt-1 block w-full"></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Liječnički (vrijedi do):</label><input type="date" id="portalMedicalDate" name="medicalDate" required class="mt-1 block w-full rounded-md border p-2"></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Upload Liječničke:</label><input type="file" id="portalMedicalFile" name="medicalFile" accept=".pdf,.jpg,.png" class="mt-1 block w-full"></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Upload Privole:</label><input type="file" id="portalConsentFile" name="consentFile" accept=".pdf" class="mt-1 block w-full"></div>
                                    <div><label class="block text-sm font-medium text-gray-700">Upload Pristupnice:</label><input type="file" id="portalAccessionFile" name="accessionFile" accept=".pdf" class="mt-1 block w-full"></div>
                                </div>
                                <button type="submit" class="w-full bg-club-red hover:bg-red-700 text-club-gold font-bold py-2 px-4 rounded-lg shadow-md transition duration-200 mt-4">
                                    SPREMI DOKUMENTE
                                </button>
                            </form>
                            <p class="text-xs text-gray-500 mt-2">Datoteke se u ovoj demo verziji ne pohranjuju, već se ažuriraju reference u bazi.</p>
                        </div>

                        <!-- Financije i Plaćanja -->
                        <div class="lg:col-span-2 p-6 bg-white rounded-xl shadow">
                            <h3 class="text-xl font-semibold mb-4 border-b pb-2">Dugovanja i Plaćanja</h3>
                            <div id="portalFeesList" class="space-y-4">
                                <p class="text-gray-500">Nema evidentiranih dugovanja.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Rezultati i Prisustvo (Agregirani prikaz za roditelja) -->
                    <div class="p-6 bg-white rounded-xl shadow mt-8">
                        <h3 class="text-xl font-semibold mb-4 border-b pb-2">Rezultati Natjecanja i Prisustvo</h3>
                        <div id="portalMemberStats" class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-6">
                            <div class="p-4 bg-gray-100 rounded-lg shadow-sm">
                                <p class="text-3xl font-bold text-club-red" id="statsTotalComps">0</p>
                                <p class="text-sm font-medium text-gray-600">Natjecanja</p>
                            </div>
                            <div class="p-4 bg-gray-100 rounded-lg shadow-sm">
                                <p class="text-3xl font-bold text-club-red" id="statsTotalWins">0</p>
                                <p class="text-sm font-medium text-gray-600">Pobjeda</p>
                            </div>
                            <div class="p-4 bg-gray-100 rounded-lg shadow-sm">
                                <p class="text-3xl font-bold text-club-red" id="statsTotalTrainings">0</p>
                                <p class="text-sm font-medium text-gray-600">Odrađeni Treninzi</p>
                            </div>
                        </div>
                        <div id="portalDetailedStats" class="text-sm text-gray-700">
                            <!-- Detaljan prikaz rezultata i treninga -->
                            <p>Za detaljan pregled svih podataka kontaktirajte klupsku administraciju.</p>
                        </div>
                    </div>

                </section>


                <!-- MODAL ZA DETALJE ČLANA/STATISTIKU (R3) -->
                <div id="memberDetailModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center" style="display:none;">
                    <div class="bg-white p-6 rounded-lg shadow-2xl w-full max-w-5xl max-h-[90vh] overflow-y-auto">
                        <h3 class="text-2xl font-bold mb-4 text-club-red border-b pb-2">Detalji Člana: <span id="modalMemberName" class="text-gray-700"></span></h3>
                        <div id="modalMemberContent">
                            <!-- Ovdje ide dinamički sadržaj -->
                        </div>
                        <div class="mt-4 flex justify-end space-x-3">
                            <button onclick="window.app.hideModal('memberDetailModal')" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-200">
                                ZATVORI
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Prazna sekcija za početak -->
                <section id="welcome" class="content-section flex items-center justify-center text-center p-6" style="min-height: calc(100vh - 80px);">
                    <div>
                        <h2 class="text-4xl font-extrabold text-club-red mb-4">Dobrodošli u Administraciju HK Podravka</h2>
                        <p class="text-xl text-gray-600">Odaberite odjeljak iz izbornika lijevo za početak rada.</p>
                        <p class="mt-8 text-sm text-gray-500">Aplikaciju pokreće Firebase Firestore za pohranu podataka.</p>
                    </div>
                </section>
            </main>
        </div>
    </div>
    
    <!-- JavaScript Modul -->
    <script type="module"> 
        // Import funkcija izravno iz Firebase CDN modula
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, addDoc, getDoc, getDocs, writeBatch, serverTimestamp, query, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Pomoćne funkcije za Firestore i vanjske biblioteke
        
        // Globalni State Aplikacije
        const STATE = {
            isAuthReady: false,
            userId: null,
            appId: null,
            db: null,
            auth: null,
            currentSection: 'welcome',
            coaches: [],
            groups: [],
            members: [],
            competitions: [],
            fees: [],
            attendance: [],
            manualTravelOrders: [],
            clubInfo: {
                logoUrl: '',
                name: 'Hrvački klub Podravka',
                address: 'Radnička 10, druga ćelija',
                city: '48000 KOPRIVNICA',
                oib: '60911784858',
                iban: '',
                web: 'https://www.hk-podravka.com',
                instagram: '',
                facebook: '',
                tiktok: ''
            },
            clubOfficials: {
                president: {},
                secretary: {},
                presidency: [],
                supervisory: []
            },
            // Roditeljski Portal State
            parentMode: false,
            parentChild: null, // Član kluba čiji se podaci gledaju
        };
        window.app = { STATE }; // Izlaganje STATE-a na window za jednostavan pristup

        // --- Opće Funkcije Aplikacije (Konvertirano u function deklaracije za bolju stabilnost) ---
        
        function setSection(sectionId) {
            document.querySelectorAll('.content-section').forEach(section => {
                section.style.display = 'none';
            });
            
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.style.display = 'block';
                STATE.currentSection = sectionId;

                // Osvježavanje listi/dropdownova na promjenu sekcije
                updateDropdowns(); 
                
                // Specifično renderiranje na temelju sekcije
                if (sectionId === 'treneri') renderCoachesList();
                if (sectionId === 'grupe') renderGroupsList();
                if (sectionId === 'clanovi') renderMembersList();
                if (sectionId === 'veterani') renderMembersList(); // Koristi istu listu, ali je sekcija filtrirana
                if (sectionId === 'natjecanja') renderCompetitionsList();
                if (sectionId === 'clanarine') renderFeesList();
                if (sectionId === 'putni_nalozi') renderTravelOrdersUI();
                if (sectionId === 'prisustvo') renderTrainingsList();
                if (sectionId === 'statistika') renderStatistics(); // Početno renderiranje prazne statistike/savjeta
            }
        }

        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'flex';
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.style.display = 'none';
        }

        function showMessage(text, type = 'success') {
            const box = document.getElementById('messageBox');
            const color = type === 'error' ? 'bg-red-500' : (type === 'warning' ? 'bg-club-gold' : 'bg-green-500');
            const element = document.createElement('div');
            element.className = `${color} text-white p-3 mb-2 rounded-lg shadow-lg max-w-sm`;
            element.textContent = text;
            box.appendChild(element);
            setTimeout(() => {
                element.remove();
            }, 5000);
        }

        function generateUUID() {
            return crypto.randomUUID();
        }

        // Firestore Helperi
        function getPrivateCollectionPath(collectionName) {
            if (!STATE.appId || !STATE.userId) throw new Error("App ID or User ID is not defined.");
            return `artifacts/${STATE.appId}/users/${STATE.userId}/${collectionName}`;
        }
        
        function getPublicCollectionPath(collectionName) {
            if (!STATE.appId) throw new Error("App ID is not defined.");
            return `artifacts/${STATE.appId}/public/data/${collectionName}`;
        }

        function updateDropdowns() {
            // Ažuriranje dropdowna za trenere
            const coachSelects = document.querySelectorAll('.coach-select-dropdown');
            coachSelects.forEach(select => {
                const selected = Array.from(select.options).filter(o => o.selected).map(o => o.value);
                select.innerHTML = STATE.coaches.map(c => 
                    `<option value="${c.id}" ${selected.includes(c.id) ? 'selected' : ''}>${c.firstName} ${c.lastName}</option>`
                ).join('');
            });
            
            // Ažuriranje dropdowna za grupe
            const groupSelects = document.querySelectorAll('.group-select-dropdown');
            groupSelects.forEach(select => {
                const selected = Array.from(select.options).filter(o => o.selected).map(o => o.value);
                select.innerHTML = '<option value="">-- Odaberite Grupu --</option>' + STATE.groups.map(g => 
                    `<option value="${g.id}" ${selected.includes(g.id) ? 'selected' : ''}>${g.name}</option>`
                ).join('');
            });
            
            // Ažuriranje dropdowna za članove
            const memberSelects = document.querySelectorAll('.member-select-dropdown');
            memberSelects.forEach(select => {
                const selected = Array.from(select.options).filter(o => o.selected).map(o => o.value);
                select.innerHTML = '<option value="">-- Odaberite Člana --</option>' + STATE.members.map(m => 
                    `<option value="${m.id}" ${selected.includes(m.id) ? 'selected' : ''}>${m.firstName} ${m.lastName} (${m.oib})</option>`
                ).join('');
            });

            // Ažuriranje dropdowna za natjecanja
            const compSelects = document.querySelectorAll('.competition-select-dropdown');
            compSelects.forEach(select => {
                const selected = Array.from(select.options).filter(o => o.selected).map(o => o.value);
                select.innerHTML = '<option value="">-- Odaberite Natjecanje --</option>' + STATE.competitions.map(c =>
                    `<option value="${c.id}" ${selected.includes(c.id) ? 'selected' : ''}>${c.type} - ${c.location} (${c.dateFrom})</option>`
                ).join('');
            });
            
            // Ažuriranje dropdowna za ručni putni nalog (manualCoach)
            const manualCoachSelect = document.getElementById('manualCoach');
            if(manualCoachSelect) {
                const selected = manualCoachSelect.value;
                manualCoachSelect.innerHTML = '<option value="">-- Odaberite Trenera --</option>' + STATE.coaches.map(c => 
                    `<option value="${c.id}" ${selected === c.id ? 'selected' : ''}>${c.firstName} ${c.lastName}</option>`
                ).join('');
            }
        }

        // --- R2: Upload i Download Članova (Simulacija) ---
        function downloadMemberTemplate() {
             // Definiranje svih polja iz sekcije Članovi
            const fields = [
                "firstName", "lastName", "oib", "dob", "gender", "group", 
                "city", "address", "email", "parentEmail", 
                "idCard", "idValidUntil", "idIssuedBy", 
                "passport", "passportValidUntil", "passportIssuedBy", 
                "medicalValidUntil", "categorizationValidUntil", "contractValidUntil",
                "active (TRUE/FALSE)", "veteran (TRUE/FALSE)", "other (TRUE/FALSE)"
            ];

            const header = fields.join('\t') + '\n';
            
            // Primjer retka
            const exampleData = [
                "Ivana", "Horvat", "12345678901", "2010-05-15", "F", "<Group_ID>", 
                "Koprivnica", "Ulica 1", "ih@test.hr", "ihorvat@test.hr", 
                "ID12345", "2028-10-10", "PU KC", 
                "P123456", "2030-01-01", "MUP", 
                "2025-12-31", "2026-06-30", "2027-01-01",
                "TRUE", "FALSE", "FALSE"
            ];
            
            const data = exampleData.join('\t') + '\n';
            const csvContent = "data:text/csv;charset=utf-8," + encodeURIComponent(header + data);
            
            const link = document.createElement('a');
            link.setAttribute('href', csvContent);
            link.setAttribute('download', 'HKP_Clanovi_Predlozak.csv');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showMessage('Predložak za uvoz članova preuzet kao CSV (otvorite u Excelu).');
        };

        function uploadMembersXLSX() {
             // Simulacija klikom na hidden file input
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.xlsx,.csv';
            input.onchange = (e) => {
                if (e.target.files.length > 0) {
                    showMessage(`Simulacija uploada: ${e.target.files[0].name}. (Potrebna implementacija za stvarnu obradu XLXS/CSV datoteke)`);
                }
            };
            input.click();
        };

        // --- R3/NOVO: Prikaz detalja člana (Modal) i Status HTML ---
        
        function getDocumentStatusHTML(validUntil, docName) {
            if (!validUntil) return `<p class="text-xs text-gray-500">${docName}: Nema datuma</p>`;
            const daysLeft = Math.floor((new Date(validUntil) - new Date()) / (1000 * 60 * 60 * 24));
            let text, className;

            if (daysLeft < 0) {
                text = `ISTEKAO (${docName})`;
                className = 'bg-red-100 text-red-700';
            } else if (daysLeft <= 14) { // Upozorenje na 14 dana
                text = `ISTJEČE za ${daysLeft} dana (${docName})`;
                className = 'bg-club-gold text-club-red';
            } else {
                text = `${docName}: OK`;
                className = 'bg-green-100 text-green-700';
            }
            return `<p class="text-xs font-semibold p-1 rounded mt-1 ${className}">${text}</p>`;
        }
        
        function isTodayBirthday(dobString) {
            if (!dobString) return false;
            const dob = new Date(dobString);
            const today = new Date();
            // Provjeravamo samo mjesec i dan
            return dob.getMonth() === today.getMonth() && dob.getDate() === today.getDate();
        }

        function sendBirthdayWish(memberId) {
             const member = STATE.members.find(m => m.id === memberId);
             if (!member || !member.email) return showMessage(`Član ${member.firstName} nema unesen email za čestitku.`, 'error');

             const message = `Dragi/a ${member.firstName},\n\nsretan ti rođendan! 🎂\nPonosni smo što si dio naše sportske obitelji.\nŽelimo ti puno veselja, prijateljstva i sportskih uspjeha — uz puno zabave na treninzima i natjecanjima! 🤼‍♂️💙\n— Tvoj Hrvački klub Podravka`;
             
             const subject = encodeURIComponent(`Sretan rođendan, ${member.firstName}!`);
             const body = encodeURIComponent(message);
             
             const mailtoLink = `mailto:${member.email}?subject=${subject}&body=${body}`;
             window.open(mailtoLink, '_blank');
             showMessage(`Simulacija slanja čestitke za ${member.firstName} (otvoren mailto link).`);
        };


        function showMemberDetails(memberId) {
            const member = STATE.members.find(m => m.id === memberId);
            if (!member) return showMessage('Član nije pronađen.', 'error');

            document.getElementById('modalMemberName').textContent = `${member.firstName} ${member.lastName}`;
            const contentDiv = document.getElementById('modalMemberContent');
            contentDiv.innerHTML = '<p class="text-gray-500 text-center py-8">Učitavanje rezultata i prisustva...</p>';

            showModal('memberDetailModal');

            // 1. Agregacija rezultata natjecanja
            let memberCompResults = [];
            STATE.competitions.forEach(comp => {
                if (comp.results && Array.isArray(comp.results)) { // Dodana provjera za postojanje i tip
                    comp.results.filter(res => res.memberId === memberId).forEach(res => {
                        memberCompResults.push({
                            ...res,
                            competitionName: comp.type,
                            date: comp.dateFrom,
                            location: comp.location
                        });
                    });
                }
            });

            // 2. Agregacija prisustva
            let totalTrainings = 0;
            let totalHours = 0;
            STATE.attendance.forEach(att => {
                if (att.members && Array.isArray(att.members) && att.members.includes(memberId)) {
                    // Pretpostavljamo da je trajanje treninga 1.5h ako nije navedeno
                    // Prilagođeno: Provjeravamo postojanje vremena prije izračuna
                    const startTime = att.timeFrom || '00:00';
                    const endTime = att.timeTo || '00:00';
                    let durationInHours = 1.5; // Default ako se ne može izračunati
                    
                    try {
                        const start = new Date(`2000/01/01 ${startTime}`);
                        const end = new Date(`2000/01/01 ${endTime}`);
                        let diffMs = end - start;
                        if (diffMs < 0) diffMs += (24 * 60 * 60 * 1000); // Prelazak preko ponoći
                        durationInHours = diffMs / (1000 * 60 * 60);
                    } catch (e) {
                         console.warn("Greška pri izračunu trajanja treninga:", e);
                    }
                    
                    totalTrainings++;
                    totalHours += durationInHours;
                }
            });
            
            // 3. Statusi dokumenata
            const medicalStatus = getDocumentStatusHTML(member.medicalValidUntil, 'Liječnički');
            const categorizationStatus = getDocumentStatusHTML(member.categorizationValidUntil, 'Kategorizacija');
            const contractStatus = getDocumentStatusHTML(member.contractValidUntil, 'Ugovor');

            // 4. Kreiranje HTML prikaza
            let html = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                    <div class="lg:col-span-1 p-4 bg-gray-100 rounded-lg shadow-inner">
                        <h4 class="font-bold text-lg text-club-red border-b mb-2">Opći Podaci</h4>
                        <p class="text-sm"><strong>Grupa:</strong> ${STATE.groups.find(g => g.id === member.group)?.name || 'N/A'}</p>
                        <p class="text-sm"><strong>OIB:</strong> ${member.oib}</p>
                        <p class="text-sm"><strong>Datum Rođenja:</strong> ${member.dob || 'N/A'}</p>
                        <p class="text-sm mt-3"><strong>Status:</strong> ${member.active ? 'Aktivan natjecatelj' : (member.veteran ? 'Veteran' : 'Ostalo')}</p>
                        
                    </div>
                    <div class="lg:col-span-2 p-4 bg-gray-100 rounded-lg shadow-inner">
                        <h4 class="font-bold text-lg text-club-red border-b mb-2">Statusi Dokumenata (Istek)</h4>
                        ${medicalStatus}
                        ${categorizationStatus}
                        ${contractStatus}
                    </div>
                </div>

                <h4 class="font-bold text-lg text-club-red border-b pb-1 mt-6 mb-3">Statistika Natjecanja i Treninga</h4>
                <div class="grid grid-cols-4 gap-4 text-center mb-6 bg-gray-100 p-4 rounded-lg">
                    <div><p class="text-2xl font-extrabold text-club-red">${memberCompResults.length}</p><p class="text-xs text-gray-600">Natjecanja</p></div>
                    <div><p class="text-2xl font-extrabold text-club-red">${memberCompResults.reduce((sum, r) => sum + (r.wins || 0), 0)}</p><p class="text-xs text-gray-600">Pobjeda</p></div>
                    <div><p class="text-2xl font-extrabold text-club-red">${totalTrainings}</p><p class="text-xs text-gray-600">Treninga</p></div>
                    <div><p class="text-2xl font-extrabold text-club-red">${totalHours.toFixed(1)}</p><p class="text-xs text-gray-600">Sati treninga</p></div>
                </div>

                <h4 class="font-bold text-lg text-club-red border-b pb-1 mt-6 mb-3">Detaljni Rezultati Natjecanja (${memberCompResults.length})</h4>
                ${memberCompResults.length > 0 ? `
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200 text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-2 text-left font-medium text-gray-500">Datum / Natjecanje</th>
                                    <th class="px-3 py-2 text-left font-medium text-gray-500">Kategorija / Stil</th>
                                    <th class="px-3 py-2 text-center font-medium text-gray-500">Plasman</th>
                                    <th class="px-3 py-2 text-center font-medium text-gray-500">Pobj/Por</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${memberCompResults.map(r => `
                                    <tr>
                                        <td class="px-3 py-2 whitespace-nowrap">${r.date}<br><span class="font-semibold">${r.competitionName} (${r.location})</span></td>
                                        <td class="px-3 py-2 whitespace-nowrap">${r.category} / ${r.style}</td>
                                        <td class="px-3 py-2 whitespace-nowrap text-center font-bold">${r.placement || 'N/A'}</td>
                                        <td class="px-3 py-2 whitespace-nowrap text-center">${r.wins || 0}/${r.losses || 0}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                ` : '<p class="text-sm text-gray-500">Nema unesenih rezultata natjecanja.</p>'}
                
                <h4 class="font-bold text-lg text-club-red border-b pb-1 mt-6 mb-3">Dokumentacija (Admin Pregled)</h4>
                <div class="grid grid-cols-2 gap-4 text-sm">
                    <div><strong>Liječnički:</strong> ${member.medicalFile ? `<a href="${member.medicalFile}" target="_blank" class="text-blue-600 hover:underline">Preuzmi</a>` : 'Nema'}</div>
                    <div><strong>Kategorizacija:</strong> ${member.categorizationFile ? `<a href="${member.categorizationFile}" target="_blank" class="text-blue-600 hover:underline">Preuzmi</a>` : 'Nema'}</div>
                    <div><strong>Ugovor:</strong> ${member.contractFile ? `<a href="${member.contractFile}" target="_blank" class="text-blue-600 hover:underline">Preuzmi</a>` : 'Nema'}</div>
                    <div><strong>Privola:</strong> ${member.consentFile ? `<a href="${member.consentFile}" target="_blank" class="text-blue-600 hover:underline">Preuzmi</a>` : 'Nema'}</div>
                    <div><strong>Pristupnica:</strong> ${member.accessionFile ? `<a href="${member.accessionFile}" target="_blank" class="text-blue-600 hover:underline">Preuzmi</a>` : 'Nema'}</div>
                </div>
            `;

            contentDiv.innerHTML = html;
        };
        
        function getMedicalStatusHTML(validUntil) {
             // Održavam staru funkciju za kompatibilnost, ali se sada koristi getDocumentStatusHTML
             return getDocumentStatusHTML(validUntil, 'Liječnički');
        }


        // --- 1. Osnovne Informacije ---
        function loadClubInfo() {
            document.getElementById('logoFile').value = ''; // Resetiraj file input
            
            // Popunjavanje ostalih polja
            document.getElementById('clubAddress').value = STATE.clubInfo.address || 'Radnička 10, druga ćelija';
            document.getElementById('clubCity').value = STATE.clubInfo.city || '48000 KOPRIVNICA';
            document.getElementById('clubOib').value = STATE.clubInfo.oib || '60911784858';
            document.getElementById('clubIBAN').value = STATE.clubInfo.iban || '';
            document.getElementById('clubWeb').value = STATE.clubInfo.web || 'https://www.hk-podravka.com';
            document.getElementById('clubInstagram').value = STATE.clubInfo.instagram || '';
            document.getElementById('clubFacebook').value = STATE.clubInfo.facebook || '';
            document.getElementById('clubTikTok').value = STATE.clubInfo.tiktok || '';
            
            // Postavljanje loga
            document.getElementById('headerLogo').src = STATE.clubInfo.logoUrl || 'https://placehold.co/40x40/cc0000/ffffff?text=HK';

            // Popunjavanje forme za officials (MOCK/SIMPLIFIED filling based on structure)
            // U stvarnosti bi se ovdje dogodilo dinamičko punjenje svih input polja na temelju STATE.clubOfficials
            // Ostavljamo mock vrijednosti jer forma trenutno koristi fiksne ID-je za prva dva
        }

        async function saveClubInfo(event) {
            event.preventDefault();
            const form = event.target;
            
            // 1. Prikupljanje osnovnih informacija (uključujući simulaciju uploada loga)
            const logoUrl = simulateFileUpload('logoFile') || STATE.clubInfo.logoUrl;

            const newInfo = {
                logoUrl: logoUrl, // Ažurirani URL
                name: form.clubName.value,
                address: form.clubAddress.value,
                city: form.clubCity.value,
                oib: form.clubOib.value,
                iban: form.clubIBAN.value,
                web: form.clubWeb.value,
                instagram: form.clubInstagram.value,
                facebook: form.clubFacebook.value,
                tiktok: form.clubTikTok.value,
            };

            const clubInfoRef = doc(STATE.db, getPrivateCollectionPath('club_info'), 'details');
            try {
                await setDoc(clubInfoRef, newInfo, { merge: true });
                STATE.clubInfo = newInfo;
                loadClubInfo();
                showMessage('Osnovne informacije uspješno spremljene!');
            } catch (error) {
                console.error("Greška pri spremanju klub info:", error);
                showMessage('Greška pri spremanju osnovnih informacija.', 'error');
            }
        }
        
        // R2: Funkcija za spremanje osoba uprave
        async function saveClubOfficials() {
            const form = document.getElementById('clubOfficialsForm');
            
            const getOfficialData = (inputs) => ({
                ime: inputs[0].value,
                prezime: inputs[1].value,
                email: inputs[2].value,
                oib: inputs[3].value,
                kontakt: inputs[4].value
            });

            // Prikupljanje podataka iz forme
            const presidentInputs = form.querySelector('.border.p-4.rounded-lg.mb-4.bg-red-50 > div.grid.grid-cols-5').querySelectorAll('input');
            const secretaryInputs = form.querySelector('.border.p-4.rounded-lg.mb-4.bg-red-50:nth-of-type(2) > div.grid.grid-cols-5').querySelectorAll('input');
            const presidencyInputs = form.querySelector('.border.p-4.rounded-lg.mb-4.bg-red-50:nth-of-type(3) > div.space-y-3').querySelectorAll('.grid.grid-cols-5 > input');
            const supervisoryInputs = form.querySelector('.border.p-4.rounded-lg.mb-6.bg-red-50 > div.space-y-3').querySelectorAll('.grid.grid-cols-5 > input');

            const newOfficials = {
                president: getOfficialData(Array.from(presidentInputs)),
                secretary: getOfficialData(Array.from(secretaryInputs)),
                presidency: [],
                supervisory: []
            };

            // Grupiranje članova predsjedništva
            for (let i = 0; i < presidencyInputs.length; i += 5) {
                newOfficials.presidency.push(getOfficialData(Array.from(presidencyInputs).slice(i, i + 5)));
            }
             // Grupiranje članova nadzornog odbora
            for (let i = 0; i < supervisoryInputs.length; i += 5) {
                newOfficials.supervisory.push(getOfficialData(Array.from(supervisoryInputs).slice(i, i + 5)));
            }

            const officialsRef = doc(STATE.db, getPrivateCollectionPath('club_officials'), 'list');
            try {
                await setDoc(officialsRef, newOfficials);
                STATE.clubOfficials = newOfficials;
                showMessage('Osobe uprave i nadzora uspješno spremljene!');
            } catch (error) {
                console.error("Greška pri spremanju osoba uprave:", error);
                showMessage('Greška pri spremanju osoba uprave.', 'error');
            }
        }


        function exportClubInfoToPDF() {
            const doc = new window.jspdf.jsPDF(); // Koristi globalnu varijablu
            const info = STATE.clubInfo;

            doc.setFontSize(18);
            doc.setTextColor(204, 0, 0); // Crvena boja
            doc.text(`Osnovne Informacije: ${info.name}`, 10, 20);
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`Sjedište: ${info.address}, ${info.city}`, 10, 30);
            doc.text(`OIB: ${info.oib}`, 10, 40);
            doc.text(`IBAN: ${info.iban}`, 10, 50);
            doc.text(`Web: ${info.web}`, 10, 60);

            doc.text(`Instagram: ${info.instagram || 'Nema'}`, 10, 70);
            doc.text(`Facebook: ${info.facebook || 'Nema'}`, 10, 80);
            doc.text(`TikTok: ${info.tiktok || 'Nema'}`, 10, 90);

            doc.save(`HKP_Info_${new Date().getFullYear()}.pdf`);
        }
        
        // --- 2. Treneri ---
        async function saveCoach(coachId) {
            const form = document.getElementById('coachForm');
            
            // R3: Simulacija uploada slike
            const imageUrl = simulateFileUpload('coachImageFile') || form.image.value;

            const data = {
                firstName: form.firstName.value,
                lastName: form.lastName.value,
                dob: form.dob.value,
                oib: form.oib.value,
                city: form.city.value,
                address: form.address.value,
                email: form.email.value,
                phone: form.phone.value,
                iban: form.iban.value,
                image: imageUrl, // Korištenje URL-a iz uploada/starog URL-a
            };

            try {
                if (coachId) {
                    await updateDoc(doc(STATE.db, getPrivateCollectionPath('coaches'), coachId), data);
                    showMessage('Podaci o treneru uspješno ažurirani.');
                } else {
                    await addDoc(collection(STATE.db, getPrivateCollectionPath('coaches')), data);
                    showMessage('Novi trener uspješno dodan.');
                }
                document.getElementById('coachFormContainer').style.display = 'none';
                form.reset();
            } catch (error) {
                console.error("Greška pri spremanju trenera:", error);
                showMessage('Greška pri spremanju trenera.', 'error');
            }
        }

        function editCoach(id) {
            const formContainer = document.getElementById('coachFormContainer');
            const form = document.getElementById('coachForm');
            const saveBtn = document.getElementById('coachSaveBtn');

            form.reset();
            saveBtn.dataset.editId = '';
            document.getElementById('coachFormTitle').textContent = 'Unos Novog Trenera';

            if (id) {
                const coach = STATE.coaches.find(c => c.id === id);
                if (coach) {
                    document.getElementById('coachFormTitle').textContent = `Uređivanje Trenera: ${coach.firstName} ${coach.lastName}`;
                    saveBtn.dataset.editId = id;
                    form.firstName.value = coach.firstName || '';
                    form.lastName.value = coach.lastName || '';
                    form.dob.value = coach.dob || '';
                    form.oib.value = coach.oib || '';
                    form.city.value = coach.city || '';
                    form.address.value = coach.address || '';
                    form.email.value = coach.email || '';
                    form.phone.value = coach.phone || '';
                    form.iban.value = coach.iban || '';
                    form.image.value = coach.image || ''; // Spremanje stare URL-a za slučaj da nema novog uploada
                }
            }
            formContainer.style.display = 'block';
        }

        async function deleteCoach(id) {
            if (!confirm("Jeste li sigurni da želite obrisati ovog trenera?")) return;
            try {
                await deleteDoc(doc(STATE.db, getPrivateCollectionPath('coaches'), id));
                showMessage('Trener uspješno obrisan.');
            } catch (error) {
                console.error("Greška pri brisanju trenera:", error);
                showMessage('Greška pri brisanju trenera.', 'error');
            }
        }

        function renderCoachesList() {
            const listDiv = document.getElementById('coachesList');
            if (!listDiv) return;

            listDiv.innerHTML = STATE.coaches.map(c => {
                const groups = STATE.groups.filter(g => g.coaches.includes(c.id)).map(g => g.name).join(', ') || 'Nema';
                return `
                    <div class="flex items-center justify-between p-3 border-b hover:bg-gray-100 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <img src="${c.image || 'https://placehold.co/40x40/cc0000/ffffff?text=T'}" onerror="this.src='https://placehold.co/40x40/cc0000/ffffff?text=T'" class="h-10 w-10 rounded-full object-cover">
                            <div>
                                <p class="font-semibold text-club-red">${c.firstName} ${c.lastName}</p>
                                <p class="text-xs text-gray-500">Vodi grupe: ${groups}</p>
                            </div>
                        </div>
                        <div class="space-x-2">
                            <a href="mailto:${c.email}" target="_blank" class="text-blue-500 hover:text-blue-700 text-sm">Email</a>
                            <a href="https://wa.me/${c.phone}" target="_blank" class="text-green-500 hover:text-green-700 text-sm">WhatsApp</a>
                            <button onclick="window.app.editCoach('${c.id}')" class="text-club-gold hover:text-yellow-700 text-sm">Izmjena</button>
                            <button onclick="window.app.deleteCoach('${c.id}')" class="text-red-500 hover:text-red-700 text-sm">Brisanje</button>
                        </div>
                    </div>
                `;
            }).join('') || '<p class="text-gray-500">Nema unesenih trenera.</p>';
        }

        // --- 3. Grupe ---
        async function saveGroup() {
            const form = document.getElementById('groupForm');
            const name = form.groupName.value;
            const coachesSelect = form.groupCoaches;
            const coaches = Array.from(coachesSelect.options).filter(o => o.selected).map(o => o.value);

            if (!name) return showMessage('Naziv grupe je obavezan.', 'warning');

            const data = { name, coaches };

            try {
                await addDoc(collection(STATE.db, getPrivateCollectionPath('groups')), data);
                showMessage('Nova grupa uspješno spremljena.');
                form.reset();
            } catch (error) {
                console.error("Greška pri spremanju grupe:", error);
                showMessage('Greška pri spremanju grupe.', 'error');
            }
        }

        async function deleteGroup(id) {
            // R4: Popravak brisanja (provjera postojanja)
            if (!confirm("Jeste li sigurni da želite obrisati ovu grupu?")) return;
            try {
                // Koristi se referenca na dokument, a ne na kolekciju.
                await deleteDoc(doc(STATE.db, getPrivateCollectionPath('groups'), id));
                showMessage('Grupa uspješno obrisana.');
            } catch (error) {
                console.error("Greška pri brisanju grupe:", error);
                showMessage('Greška pri brisanju grupe.', 'error');
            }
        }
        
        function renderGroupsList() {
            const listDiv = document.getElementById('groupsList');
            if (!listDiv) return;

            listDiv.innerHTML = STATE.groups.map(g => {
                const coachNames = g.coaches.map(cId => {
                    const coach = STATE.coaches.find(c => c.id === cId);
                    return coach ? `${coach.firstName.charAt(0)}.${coach.lastName}` : 'Nepoznat';
                }).join(', ');
                const memberCount = STATE.members.filter(m => m.group === g.id).length;

                return `
                    <div class="flex items-center justify-between p-3 border-b hover:bg-gray-100 rounded-lg">
                        <div>
                            <p class="font-semibold text-club-red">${g.name}</p>
                            <p class="text-xs text-gray-500">Treneri: ${coachNames || 'Nema'}</p>
                            <p class="text-xs text-gray-500">Članova: ${memberCount}</p>
                        </div>
                        <div class="space-x-2">
                            <button onclick="window.app.deleteGroup('${g.id}')" class="text-red-500 hover:text-red-700 text-sm">Brisanje</button>
                        </div>
                    </div>
                `;
            }).join('') || '<p class="text-gray-500">Nema unesenih grupa.</p>';
        }

        // --- 4. Članovi ---
        // Helper funkcija za simulaciju uploada (R1)
        function simulateFileUpload(fileInputId) {
            const fileInput = document.getElementById(fileInputId);
            if (fileInput && fileInput.files.length > 0) {
                // Generiramo samo placeholder URL
                const file = fileInput.files[0];
                return `simulated_upload/${file.name}_${Date.now()}`;
            }
            // Vraća prethodno spremljenu URL ako postoji (za editiranje, gdje se ne šalje novi file)
            const memberId = document.getElementById('memberSaveBtn').dataset.editId;
            if(memberId) {
                const member = STATE.members.find(m => m.id === memberId);
                const fieldName = fileInputId.replace('member', '');
                const key = fieldName.charAt(0).toLowerCase() + fieldName.slice(1);
                // Provjera za datoteke koje imaju "File" u imenu
                if (key.endsWith('File')) {
                    // Ako je input tipa file, a u bazi imamo URL, dohvati je.
                    // npr. za input 'memberMedicalFile', ključ u bazi je 'medicalFile'
                    return member[key] || ''; 
                }
                return member[key] || '';
            }
            return '';
        }

        async function saveMember(memberId) {
            const form = document.getElementById('memberForm');
            
            // Prikupljanje podataka i simulacija uploada dokumenata (R1 + NOVO)
            const data = {
                firstName: form.firstName.value,
                lastName: form.lastName.value,
                dob: form.dob.value,
                gender: form.gender.value,
                oib: form.oib.value || generateUUID(), 
                city: form.city.value,
                address: form.address.value,
                email: form.email.value,
                parentEmail: form.parentEmail.value,
                idCard: form.idCard.value,
                idValidUntil: form.idValidUntil.value,
                idIssuedBy: form.idIssuedBy.value,
                passport: form.passport.value,
                passportValidUntil: form.passportValidUntil.value,
                passportIssuedBy: form.passportIssuedBy.value,
                group: form.memberGroup.value,
                active: form.memberActive.checked,
                veteran: form.memberVeteran.checked,
                other: form.memberOther.checked,
                // Dokumentacija
                medicalFile: simulateFileUpload('memberMedicalFile'), 
                medicalValidUntil: form.memberMedicalValidUntil.value,
                consentFile: simulateFileUpload('memberConsentFile'),
                accessionFile: simulateFileUpload('memberAccessionFile'),
                // NOVO: Kategorizacija
                categorizationFile: simulateFileUpload('memberCategorizationFile'),
                categorizationValidUntil: form.memberCategorizationValidUntil.value,
                // NOVO: Ugovor
                contractFile: simulateFileUpload('memberContractFile'),
                contractValidUntil: form.memberContractValidUntil.value,
            };

            if (!data.oib) return showMessage('OIB je obavezan podatak!', 'error');

            try {
                let docRef;
                if (memberId) {
                    docRef = doc(STATE.db, getPrivateCollectionPath('members'), memberId);
                    await updateDoc(docRef, data);
                    showMessage('Podaci o članu uspješno ažurirani.');
                } else {
                    docRef = await addDoc(collection(STATE.db, getPrivateCollectionPath('members')), data);
                    showMessage('Novi član uspješno dodan.');
                    // Generiranje pristupnice (jednostavna verzija)
                    generateAccessionFormPDF(data, docRef.id);
                }

                document.getElementById('memberFormContainer').style.display = 'none';
                form.reset();
            } catch (error) {
                console.error("Greška pri spremanju člana:", error);
                showMessage('Greška pri spremanju člana.', 'error');
            }
        }

        function addClubHeader(doc, title) {
            const clubInfo = STATE.clubInfo;
            const logoUrl = clubInfo.logoUrl || 'https://placehold.co/40x40/cc0000/ffffff?text=HK';

            // Postavljanje loga (Simulacija)
            // U stvarnoj aplikaciji, ovdje bi išao kompleksni loading slika s promise-ima
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text(`Logo (Simulacija URL: ${logoUrl.substring(0, 30)}...)`, 10, 10);
            
            // Podaci o klubu
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.setFont('Helvetica', 'bold');
            doc.text(`${clubInfo.name}`, 200, 10, { align: 'right' });
            doc.setFont('Helvetica', 'normal');
            doc.text(`${clubInfo.address}, ${clubInfo.city}`, 200, 14, { align: 'right' });
            doc.text(`OIB: ${clubInfo.oib}`, 200, 18, { align: 'right' });
            
            // Naslov dokumenta
            doc.setFontSize(16);
            doc.setTextColor(204, 0, 0); // Crvena
            doc.setFont('Helvetica', 'bold');
            doc.text(title.toUpperCase(), 105, 35, { align: 'center' });
            doc.line(70, 37, 140, 37); // Podcrtano

            return 45; // Vraća y-koordinatu nakon zaglavlja
        }
        
        function generateAccessionFormPDF(member, memberId) {
            const doc = new window.jspdf.jsPDF(); 
            let y = addClubHeader(doc, 'PRISTUPNICA');
            const margin = 15;
            
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            
            // Popunjavanje podataka člana
            y += 10;
            doc.setFont('Helvetica', 'bold');
            doc.text('OSNOVNI PODACI ČLANA:', margin, y);
            y += 5;
            doc.setFont('Helvetica', 'normal');
            doc.text(`IME I PREZIME ČLANA: ${member.firstName} ${member.lastName}`, margin, y);
            y += 5;
            doc.text(`DATUM ROĐENJA: ${member.dob || 'N/A'}`, margin, y);
            doc.text(`OIB: ${member.oib || 'N/A'}`, 100, y);
            y += 5;
            doc.text(`IME RODITELJA/STARATELJA: ${member.parentEmail.split('@')[0] || 'N/A'} (Email: ${member.parentEmail || 'N/A'})`, margin, y); // Koristimo dio emaila kao ime roditelja
            y += 5;
            doc.text(`DATUM PRISTUPANJA: ${new Date().toLocaleDateString('hr-HR')}`, margin, y);
            y += 10;
            
            // Sadržaj iz PRISTUPNICA.docx
            doc.setFont('Helvetica', 'bold');
            doc.text('STATUT KLUBA - ČLANSTVO (Članak 14., 15.):', margin, y);
            y += 5;
            doc.setFont('Helvetica', 'normal');
            
            const statutText = [
                "Članom Kluba može postati svaki poslovno sposoban državljanin Republike Hrvatske i pravna osoba sa sjedištem u Republici Hrvatskoj, koji prihvaćaju načela na kojima se Klub zasniva i Statut Kluba. Članom kluba mogu postati i fizičke osobe bez poslovne sposobnosti za koje pristupnicu ispunjava roditelj (staratelj). Osobe bez poslovne sposobnosti mogu sudjelovati u radu Kluba bez prava odlučivanja. Članom Kluba se postaje potpisivanjem pristupnice i izjavom o prihvaćanju Statuta te upisom u Registar članova koji vodi tajnik Kluba, a odluku o primitku u članstvo donosi Predsjedništvo."
            ];
            statutText.forEach(line => {
                const textLines = doc.splitTextToSize(line, 180);
                doc.text(textLines, margin, y);
                y += textLines.length * 4;
            });
            y += 5;
            
            doc.setFont('Helvetica', 'bold');
            doc.text('ČLANARINA JE OBVEZUJUĆA:', margin, y);
            y += 5;
            doc.setFont('Helvetica', 'normal');
            const clanarinaText = "ČLANARINA JE OBVEZUJUĆA TIJEKOM CIJELE GODINE (12 MJESECI) I ČLAN JU JE DUŽAN PLAČATI SVE DOK DRAGOVOLJNO NE ISTUPI IZ KLUBA ODNOSNO NE DOSTAVI ISPUNJENU ISTUPNICU O PRESTANKU ČLANSTVA.";
            const clanarinaLines = doc.splitTextToSize(clanarinaText, 180);
            doc.text(clanarinaLines, margin, y);
            y += clanarinaLines.length * 4;
            y += 5;

            doc.setFont('Helvetica', 'bold');
            doc.text('IZJAVA O ODGOVORNOSTI:', margin, y);
            y += 5;
            doc.setFont('Helvetica', 'normal');
            const izjavaText = `Hrvanje je borilački šport u kojemu su kao i ostalim drugim sportovima moguće ozljede prilikom treninga i natjecanja. Svojim potpisom suglasni smo da naše dijete (${member.firstName} ${member.lastName}) pohađa treninge i da se natječe. Za eventualne nastale povrede prilikom treninga ili natjecanja u potpunosti preuzimamo odgovornost. Također obvezujemo se kao roditelji-staratelji da ćemo u roku od šest mjeseci od dana upisa svojem djetetu omogućiti adekvatnu opremu za trening i natjecanje. Svojim potpisom prihvaćam/o načela na kojima se klub zasniva i Statut Kluba.`;
            const izjavaLines = doc.splitTextToSize(izjavaText, 180);
            doc.text(izjavaLines, margin, y);
            y += izjavaLines.length * 4;
            y += 10;
            
            doc.text(`U ${STATE.clubInfo.city}, ${new Date().toLocaleDateString('hr-HR')}`, margin, y);
            y += 10;
            
            doc.text(`POTPIS ČLANA: ___________________________________________`, margin, y);
            y += 10;
            doc.text(`POTPIS RODITELJA/STARATELJA: ____________________________`, margin, y);
            doc.setFontSize(8);
            doc.text(`(za punoljetnog člana ovaj potpis je nepotreban)`, 120, y + 4);

            doc.save(`HKP_Pristupnica_${member.lastName}.pdf`);
        }

        function generateConsentFormPDF(member, memberId) {
             const doc = new window.jspdf.jsPDF(); 
             let y = addClubHeader(doc, 'PRIVOLA');
             const margin = 15;

             doc.setFontSize(10);
             doc.setTextColor(0, 0, 0);
             
             // Uvod (skraćeno)
             const introText = "Sukladno Zakonu o zaštiti osobnih podataka i Općoj uredbi o zaštiti podataka (GDPR), svrha zaštite osobnih podataka je zaštita privatnog života i ostalih ljudskih prava i temeljnih sloboda. Zaštita je osigurana svakoj fizičkoj osobi.";
             const introLines = doc.splitTextToSize(introText, 180);
             doc.setFont('Helvetica', 'normal');
             doc.text(introLines, margin, y);
             y += introLines.length * 4;
             y += 10;

             // Podaci o članu (za koga se daje privola)
             doc.setFont('Helvetica', 'bold');
             doc.text(`PRIVOLA`, margin, y); 
             
             // Completing the structure based on the pattern of generateAccessionFormPDF
             y += 5;
             doc.setFont('Helvetica', 'normal');
             doc.text(`Član (Za koga se daje): ${member.firstName} ${member.lastName} (OIB: ${member.oib})`, margin, y);
             y += 5;
             doc.text(`Roditelj/Staratelj: ${member.parentEmail.split('@')[0]}`, margin, y);
             
             y += 10;
             
             doc.setFont('Helvetica', 'normal');
             const consentDetail = "Ovim putem dajem PRIVOLU klubu za prikupljanje, obradu i objavu osobnih podataka, uključujući ime, prezime, dob, rezultate, fotografije i video materijale, isključivo u svrhu promidžbe hrvanja, izvještavanja o natjecanjima i vođenja klupske evidencije.";
             const consentLines = doc.splitTextToSize(consentDetail, 180);
             doc.text(consentLines, margin, y);
             y += consentLines.length * 4;
             y += 10;
             
             doc.text(`U ${STATE.clubInfo.city}, ${new Date().toLocaleDateString('hr-HR')}`, margin, y);
             y += 15;
             doc.text(`POTPIS RODITELJA/STARATELJA: ____________________________`, margin, y);

             doc.save(`HKP_Privola_${member.lastName}.pdf`);
        }

        // Helper stubs for missing functions
        function openMemberEditForm(id) { editMember(id); } 
        
        function editMember(id) { 
            const formContainer = document.getElementById('memberFormContainer');
            const form = document.getElementById('memberForm');
            const saveBtn = document.getElementById('memberSaveBtn');
            form.reset();
            saveBtn.dataset.editId = id || '';
            document.getElementById('memberFormTitle').textContent = id ? 'Uređivanje Člana' : 'Unos Novog Člana';

            if (id) {
                const member = STATE.members.find(m => m.id === id);
                if (member) {
                     // Populate form fields (simplified, assumes matching IDs)
                     Object.keys(member).forEach(key => {
                        const input = document.getElementById(`member${key.charAt(0).toUpperCase() + key.slice(1)}`);
                        if (input && input.type !== 'checkbox') input.value = member[key] || '';
                        if (input && input.type === 'checkbox') input.checked = member[key] || false;
                     });
                     // Special handling for group selection
                     const groupSelect = document.getElementById('memberGroup');
                     if (groupSelect) groupSelect.value = member.group;
                }
            }
            formContainer.style.display = 'block';
        }
        async function deleteMember(id) { 
            if (!confirm("Jeste li sigurni da želite obrisati ovog člana?")) return;
            try {
                // Simulacija brisanja
                showMessage('Član uspješno obrisan (Simulacija).', 'success');
            } catch (error) {
                console.error("Greška pri brisanju člana:", error);
                showMessage('Greška pri brisanju člana.', 'error');
            }
        }
        function saveCompetition(id) { showMessage('Natjecanje spremljeno (Simulacija).', 'success'); }
        function editCompetition(id) { showMessage('Otvoren formular za natjecanje (Simulacija).', 'warning'); document.getElementById('competitionFormContainer').style.display='block'; }
        function deleteCompetition(id) { showMessage('Natjecanje obrisano (Simulacija).', 'success'); }
        function addCompetitorResultField() { showMessage('Dodano polje za rezultat (Simulacija).', 'warning'); }
        function renderStatistics() { 
            const resultsDiv = document.getElementById('statisticsResults');
            if(resultsDiv) resultsDiv.innerHTML = '<p class="text-green-600 font-semibold">Statistika je generirana i prikazana ovdje (Simulacija).</p>';
            showMessage('Statistika generirana (Simulacija).', 'success'); 
        }
        function saveAttendance() { 
            showMessage('Trening spremljen (Simulacija).', 'success'); 
            document.getElementById('memberAttendanceListContainer').style.display='block'; 
        }
        function saveMemberAttendance() { 
            showMessage('Prisutnost spremljena (Simulacija).', 'success'); 
            document.getElementById('memberAttendanceListContainer').style.display='none'; 
        }
        function savePreparation() { showMessage('Priprema spremljena (Simulacija).', 'success'); }
        function sendNotification() { showMessage('Obavijest poslana (Simulacija).', 'success'); }
        function createMembershipFees() { showMessage('Uplatnice kreirane (Simulacija).', 'success'); }
        function showPaymentSlipModal(fee) { showModal('paymentSlipModal'); }
        function exportPaymentSlipToPDF() { showMessage('Uplatnica preuzeta (Simulacija).', 'success'); }
        function showTravelOrderForm() { document.getElementById('manualTravelOrderFormContainer').style.display='block'; }
        function saveManualTravelOrder(id) { showMessage('Putni nalog spremljen (Simulacija).', 'success'); document.getElementById('manualTravelOrderFormContainer').style.display='none'; }
        function deleteTravelOrder(id) { showMessage('Putni nalog obrisan (Simulacija).', 'success'); }
        function showTravelOrderDetails(id) { showModal('travelOrderModal'); }
        function exportTravelOrderToPDF() { showMessage('Putni nalog preuzet (Simulacija).', 'success'); }
        function parentLogin() { 
             const email = document.getElementById('parentLoginEmail').value;
             const oib = document.getElementById('parentLoginOIB').value;
             const child = STATE.members.find(m => m.parentEmail === email && m.oib === oib);
             
             if (child) {
                 STATE.parentChild = child;
                 document.getElementById('portalChildName').textContent = `${child.firstName} ${child.lastName}`;
                 document.getElementById('parentLogoutContainer').style.display = 'block';
                 document.getElementById('adminSidebar').style.display = 'none'; // Sakrij admin sidebar
                 setSection('roditeljski_portal');
                 showMessage(`Prijava uspješna. Dobrodošli, roditelj od ${child.firstName}!`, 'success');
             } else {
                 showMessage('Neispravan email roditelja ili OIB djeteta.', 'error');
             }
         }
        function parentUploadDocuments() { 
            showMessage('Dokumenti poslani (Simulacija).', 'success'); 
            // In a real app, you would handle file upload here and update Firestore document references.
        }


        // --- Firestore Listeners ---
        function setupFirestoreListeners() {
            if (!STATE.db) return;

            // Club Info (Private)
            const clubInfoRef = doc(STATE.db, getPrivateCollectionPath('club_info'), 'details');
            onSnapshot(clubInfoRef, (docSnap) => {
                if (docSnap.exists()) {
                    STATE.clubInfo = { ...STATE.clubInfo, ...docSnap.data() };
                    loadClubInfo();
                }
            }, (error) => console.error("Error fetching club info:", error));

            // Club Officials (Private)
            const officialsRef = doc(STATE.db, getPrivateCollectionPath('club_officials'), 'list');
            onSnapshot(officialsRef, (docSnap) => {
                if (docSnap.exists()) {
                    STATE.clubOfficials = docSnap.data();
                    // No automatic reload for officials form, as it's static/mocked values
                }
            }, (error) => console.error("Error fetching officials:", error));

            // Coaches (Private)
            const coachesCol = collection(STATE.db, getPrivateCollectionPath('coaches'));
            onSnapshot(coachesCol, (snapshot) => {
                STATE.coaches = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateDropdowns();
                if (STATE.currentSection === 'treneri') renderCoachesList();
            }, (error) => console.error("Error fetching coaches:", error));

            // Groups (Private)
            const groupsCol = collection(STATE.db, getPrivateCollectionPath('groups'));
            onSnapshot(groupsCol, (snapshot) => {
                STATE.groups = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateDropdowns();
                if (STATE.currentSection === 'grupe') renderGroupsList();
            }, (error) => console.error("Error fetching groups:", error));

            // Members (Private)
            const membersCol = collection(STATE.db, getPrivateCollectionPath('members'));
            onSnapshot(membersCol, (snapshot) => {
                STATE.members = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateDropdowns();
                if (STATE.currentSection === 'clanovi' || STATE.currentSection === 'veterani') renderMembersList();
            }, (error) => console.error("Error fetching members:", error));
            
            // Competitions (Public - used for shared results)
            const compsCol = collection(STATE.db, getPublicCollectionPath('competitions'));
            onSnapshot(compsCol, (snapshot) => {
                STATE.competitions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateDropdowns();
                if (STATE.currentSection === 'natjecanja') renderCompetitionsList();
            }, (error) => console.error("Error fetching competitions:", error));
            
             // Fees (Private)
            const feesCol = collection(STATE.db, getPrivateCollectionPath('fees'));
            onSnapshot(feesCol, (snapshot) => {
                STATE.fees = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if (STATE.currentSection === 'clanarine') renderFeesList();
            }, (error) => console.error("Error fetching fees:", error));
            
             // Attendance (Private)
            const attendanceCol = collection(STATE.db, getPrivateCollectionPath('attendance'));
            onSnapshot(attendanceCol, (snapshot) => {
                STATE.attendance = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if (STATE.currentSection === 'prisustvo') renderTrainingsList();
            }, (error) => console.error("Error fetching attendance:", error));
            
            // Travel Orders (Private)
            const travelOrdersCol = collection(STATE.db, getPrivateCollectionPath('travel_orders'));
            onSnapshot(travelOrdersCol, (snapshot) => {
                STATE.manualTravelOrders = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                if (STATE.currentSection === 'putni_nalozi') renderTravelOrdersUI();
            }, (error) => console.error("Error fetching travel orders:", error));
        }

        // --- Renderiranje Članova (Dodano) ---
        function renderMembersList() {
            const isVeteranSection = STATE.currentSection === 'veterani';
            const list = STATE.members.filter(m => m.veteran === isVeteranSection); // Filter based on section
            const tableBodyId = isVeteranSection ? 'veteransTableBody' : 'membersTableBody';
            const targetTableBody = document.getElementById(tableBodyId);

            if (!targetTableBody) return;

            targetTableBody.innerHTML = list.map(m => {
                const groupName = STATE.groups.find(g => g.id === m.group)?.name || 'N/A';
                const medicalStatus = getMedicalStatusHTML(m.medicalValidUntil);
                const isBday = isTodayBirthday(m.dob);
                const bdayIcon = isBday ? `<span class="bday-icon">🎂</span>` : '';
                
                // Prikaz statusa dokumenata (pojednostavljeno)
                let statusBadges = [];
                const medicalDays = m.medicalValidUntil ? Math.floor((new Date(m.medicalValidUntil) - new Date()) / (1000 * 60 * 60 * 24)) : -1;
                const categorizationDays = m.categorizationValidUntil ? Math.floor((new Date(m.categorizationValidUntil) - new Date()) / (1000 * 60 * 60 * 24)) : -1;
                const contractDays = m.contractValidUntil ? Math.floor((new Date(m.contractValidUntil) - new Date()) / (1000 * 60 * 60 * 24)) : -1;

                if (medicalDays < 0) statusBadges.push('<span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">LJEK-ISTEK</span>');
                else if (medicalDays <= 30) statusBadges.push('<span class="bg-club-gold text-club-red text-xs font-bold px-2 py-1 rounded-full">LJEK-UPZ</span>');
                
                if (categorizationDays < 0) statusBadges.push('<span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">KAT-ISTEK</span>');
                
                if (contractDays < 0) statusBadges.push('<span class="bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">UGOV-ISTEK</span>');


                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 flex items-center">
                            ${bdayIcon} ${m.firstName} ${m.lastName}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${groupName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                             ${medicalStatus}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 space-x-1">
                            ${statusBadges.join('') || '<span class="text-green-600 text-xs font-semibold">Dokumenti OK</span>'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                            <button onclick="window.app.showMemberDetails('${m.id}')" class="text-blue-500 hover:text-blue-700 text-sm">Detalji</button>
                            <button onclick="window.app.openMemberEditForm('${m.id}')" class="text-club-gold hover:text-yellow-700 text-sm">Izmjena</button>
                            <button onclick="window.app.deleteMember('${m.id}')" class="text-red-500 hover:text-red-700 text-sm">Brisanje</button>
                        </td>
                    </tr>
                `;
            }).join('') || `<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">Nema aktivnih članova/veterana.</td></tr>`;
        }

        // --- Renderiranje Natjecanja (Dodano) ---
        function renderCompetitionsList() {
            const tableBody = document.getElementById('competitionsTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = STATE.competitions.map(c => {
                const coaches = c.coaches?.map(cId => {
                    const coach = STATE.coaches.find(t => t.id === cId);
                    return coach ? `${coach.lastName}` : 'N/A';
                }).join(', ') || 'Nema';
                
                const typeDisplay = c.type === 'OSTALO' ? c.otherType : c.type;
                const dateDisplay = c.dateFrom === c.dateTo || !c.dateTo ? c.dateFrom : `${c.dateFrom} - ${c.dateTo}`;
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${dateDisplay}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${typeDisplay}<br><span class="text-xs text-gray-400">${c.location} (${c.countryCode})</span></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${c.ageGroup} / ${c.style}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${coaches}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                            <button onclick="window.app.showCompetitionDetails('${c.id}')" class="text-blue-500 hover:text-blue-700 text-sm">Detalji</button>
                            <button onclick="window.app.editCompetition('${c.id}')" class="text-club-gold hover:text-yellow-700 text-sm">Izmjena</button>
                            <button onclick="window.app.deleteCompetition('${c.id}')" class="text-red-500 hover:text-red-700 text-sm">Brisanje</button>
                        </td>
                    </tr>
                `;
            }).join('') || `<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">Nema unesenih natjecanja.</td></tr>`;
        }
        
        // --- Renderiranje Članarina (Dodano) ---
        function renderFeesList() {
             const tableBody = document.getElementById('feesTableBody');
             if (!tableBody) return;

             // Grupiramo članarine po članu i datumu za jednostavan prikaz
             const groupedFees = STATE.fees.map(f => {
                const member = STATE.members.find(m => m.id === f.memberId);
                const statusColor = f.status === 'PAID' ? 'bg-green-100 text-green-700' : (f.status === 'OVERDUE' ? 'bg-red-100 text-red-700' : 'bg-club-gold text-club-red');
                const statusText = f.status === 'PAID' ? 'PLAĆENO' : (f.status === 'OVERDUE' ? 'DUGUJE' : 'NEPLAĆENO');

                 return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${member ? `${member.firstName} ${member.lastName}` : 'N/A'}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${f.monthYear}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${f.amount} EUR</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">${statusText}</span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                            <button onclick="window.app.showPaymentSlipModal('${f.id}')" class="text-blue-500 hover:text-blue-700 text-sm">Uplatnica</button>
                            <button onclick="window.app.markFeeAsPaid('${f.id}')" class="text-green-500 hover:text-green-700 text-sm">Označi Plaćeno</button>
                        </td>
                    </tr>
                `;
             }).join('') || `<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">Nema unesenih članarina.</td></tr>`;
             
             tableBody.innerHTML = groupedFees;
        }

        // Dodana funkcija za označavanje plaćanja
        window.app.markFeeAsPaid = async (feeId) => {
            try {
                const feeRef = doc(STATE.db, getPrivateCollectionPath('fees'), feeId);
                await updateDoc(feeRef, { status: 'PAID', paidAt: serverTimestamp() });
                showMessage('Članarina uspješno označena kao plaćena.');
            } catch (error) {
                console.error("Greška pri ažuriranju plaćanja:", error);
                showMessage('Greška pri ažuriranju plaćanja.', 'error');
            }
        };

        // --- Renderiranje Treninga (Dodano) ---
        function renderTrainingsList() {
            const tableBody = document.getElementById('trainingsTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = STATE.attendance.map(a => {
                const groupName = STATE.groups.find(g => g.id === a.group)?.name || 'N/A';
                const coaches = a.coaches?.map(cId => {
                    const coach = STATE.coaches.find(t => t.id === cId);
                    return coach ? `${coach.lastName}` : 'N/A';
                }).join(', ') || 'Nema';
                
                // Izračunavanje trajanja (sati)
                const startTime = a.timeFrom;
                const endTime = a.timeTo;
                let duration = 'N/A';
                if (startTime && endTime) {
                    const start = new Date(`2000/01/01 ${startTime}`);
                    const end = new Date(`2000/01/01 ${endTime}`);
                    let diffMs = end - start;
                    if (diffMs < 0) diffMs += (24 * 60 * 60 * 1000); // Prelazak preko ponoći
                    duration = (diffMs / (1000 * 60 * 60)).toFixed(1); // Sati
                }
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${a.date}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${groupName}<br><span class="text-xs text-gray-400">${a.location === 'OSTALO' ? a.otherLocation : a.location}</span></td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${coaches}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${duration} h</td>
                    </tr>
                `;
            }).join('') || `<tr><td colspan="4" class="px-6 py-4 text-center text-gray-500">Nema unesenih treninga.</td></tr>`;
        }
        
        // --- Renderiranje Putnih Naloga (Dodano) ---
        function renderTravelOrdersUI() {
            const tableBody = document.getElementById('travelOrdersTableBody');
            if (!tableBody) return;
            
            tableBody.innerHTML = STATE.manualTravelOrders.map(t => {
                const coach = STATE.coaches.find(c => c.id === t.coachId);
                const coachName = coach ? `${coach.firstName} ${coach.lastName}` : 'N/A';
                const dateDisplay = t.dateFrom === t.dateTo || !t.dateTo ? t.dateFrom : `${t.dateFrom} - ${t.dateTo}`;
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${t.id.substring(0, 8).toUpperCase()}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${coachName}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${t.purpose} (${t.destination})</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${dateDisplay}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                            <button onclick="window.app.showTravelOrderDetails('${t.id}')" class="text-blue-500 hover:text-blue-700 text-sm">Pregled</button>
                            <button onclick="window.app.deleteTravelOrder('${t.id}')" class="text-red-500 hover:text-red-700 text-sm">Brisanje</button>
                        </td>
                    </tr>
                `;
            }).join('') || `<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">Nema unesenih putnih naloga.</td></tr>`;
            
            // Logika za prikaz/skrivanje KM polja u ručnom unosu
             const manualTravelType = document.getElementById('manualTravelType');
             const manualMileageFields = document.getElementById('manualMileageFields');
             if (manualTravelType) {
                 manualTravelType.onchange = () => {
                     if (manualTravelType.value === 'SLUZBENO' || manualTravelType.value === 'OSOBNO') {
                         manualMileageFields.style.display = 'grid';
                     } else {
                         manualMileageFields.style.display = 'none';
                     }
                 };
             }
        }


        // --- Inicijalizacija i Autentikacija ---
        async function initializeAppAndAuth() {
            // Globalne varijable iz Canvas okruženja
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

            if (!firebaseConfig || !firebaseConfig.apiKey) {
                console.error("Firebase config is missing or invalid.");
                return;
            }

            STATE.appId = appId;
            
            try {
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const auth = getAuth(app);
                
                STATE.db = db;
                STATE.auth = auth;

                // Koristimo sesijsku perzistenciju da se korisnik ne mora ponovno prijavljivati nakon osvježavanja
                await setPersistence(auth, browserSessionPersistence);
                
                // Prijavljivanje korisnika: preferira se custom token, inače anonimna prijava
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // Slušanje promjena stanja autentikacije
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        STATE.userId = user.uid;
                        STATE.isAuthReady = true;
                        
                        // Sada kada smo prijavljeni, postavljamo Firestore listenere
                        setupFirestoreListeners();
                        console.log("Firebase Auth Ready. User ID:", user.uid);
                    } else {
                        STATE.userId = generateUUID(); // Fallback za neautentificiranog korisnika (iako bi Auth trebao raditi)
                        STATE.isAuthReady = true; 
                        console.log("Firebase Auth Ready (Anonymous or Fallback).");
                    }
                    
                    // Postavljanje početne sekcije
                    const urlParams = new URLSearchParams(window.location.search);
                    const initialSection = urlParams.get('section') || 'welcome';
                    setSection(initialSection);
                });

            } catch (error) {
                console.error("Greška pri inicijalizaciji Firebasea ili autentikaciji:", error);
                showMessage('Greška pri spajanju na bazu podataka.', 'error');
            }
        }

        // --- Inicijalizacija Aplikacije ---
        window.addEventListener('load', initializeAppAndAuth);

        // Izlaganje glavnih funkcija na window.app
        // Uključivanje svih funkcija koje se pozivaju iz HTML-a
        window.app.setSection = setSection;
        window.app.showModal = showModal;
        window.app.hideModal = hideModal;

        window.app.saveClubInfo = saveClubInfo;
        window.app.saveClubOfficials = saveClubOfficials;
        window.app.exportClubInfoToPDF = exportClubInfoToPDF;
        
        window.app.saveCoach = saveCoach;
        window.app.editCoach = editCoach;
        window.app.deleteCoach = deleteCoach;
        
        window.app.saveGroup = saveGroup;
        window.app.deleteGroup = deleteGroup;
        
        window.app.openMemberEditForm = openMemberEditForm;
        window.app.saveMember = saveMember;
        window.app.deleteMember = deleteMember;
        window.app.downloadMemberTemplate = downloadMemberTemplate;
        window.app.uploadMembersXLSX = uploadMembersXLSX;
        window.app.showMemberDetails = showMemberDetails;
        window.app.sendBirthdayWish = sendBirthdayWish;

        window.app.saveCompetition = saveCompetition;
        window.app.editCompetition = editCompetition;
        window.app.deleteCompetition = deleteCompetition;
        window.app.addCompetitorResultField = addCompetitorResultField; 

        window.app.renderStatistics = renderStatistics; 

        window.app.saveAttendance = saveAttendance; 
        window.app.saveMemberAttendance = saveMemberAttendance; 
        window.app.savePreparation = savePreparation; 

        window.app.sendNotification = sendNotification; 

        window.app.createMembershipFees = createMembershipFees; 
        window.app.showPaymentSlipModal = showPaymentSlipModal; 
        window.app.exportPaymentSlipToPDF = exportPaymentSlipToPDF; 
        window.app.markFeeAsPaid = window.app.markFeeAsPaid;

        window.app.showTravelOrderForm = showTravelOrderForm; 
        window.app.saveManualTravelOrder = saveManualTravelOrder; 
        window.app.deleteTravelOrder = deleteTravelOrder; 
        window.app.showTravelOrderDetails = showTravelOrderDetails; 
        window.app.exportTravelOrderToPDF = exportTravelOrderToPDF; 

        window.app.parentLogin = parentLogin; 
        window.app.parentUploadDocuments = parentUploadDocuments; 
        
        // Dodatne PDF funkcije (generiranje na zahtjev)
        window.app.generateAccessionFormPDF = generateAccessionFormPDF;
        window.app.generateConsentFormPDF = generateConsentFormPDF;

    </script>
</body>
</html>
    </script>
</body>
</html>
